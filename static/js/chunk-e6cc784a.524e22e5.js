(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e6cc784a"],{3297:function(t,e,a){},"82a7":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"balance-gross"},[a("van-sticky",[a("div",[a("div",{staticClass:"white-bg filter-div"},[a("div",{class:["pa-10 common-filter",t.showFilter?"color-main-2":"",t.filterActive?"common-filter--active":""],on:{click:t.showPopup}},[a("span",[t._v("条件筛选")]),a("van-icon",{class:{"active-filter":t.showFilter},attrs:{name:t.showFilter?"arrow-up":"arrow-down"}})],1)]),a("div",{staticClass:"page-title"},[t._v(" 平衡毛利("+t._s(t.deptName)+")"+t._s(t.titleDateRange.startYear)+"年"+t._s(t.titleDateRange.startMonth)+"月-"+t._s(t.titleDateRange.endYear)+"年"+t._s(t.titleDateRange.endMonth)+"月 ")])])]),a("van-popup",{attrs:{position:"top"},on:{"click-overlay":t.closePupup},model:{value:t.showFilter,callback:function(e){t.showFilter=e},expression:"showFilter"}},[a("div",{staticClass:"popup-line"}),a("van-field",{attrs:{readonly:"",clickable:"",label:"部门",placeholder:"点击输入部门信息","input-align":"right"},on:{click:t.showDeptPickerPopup},model:{value:t.filterObj.deptName,callback:function(e){t.$set(t.filterObj,"deptName",e)},expression:"filterObj.deptName"}}),a("van-field",{attrs:{readonly:"",clickable:"",name:"datetimePicker",value:t.filterObj.date,"input-align":"right",label:"日期选择",placeholder:"点击选择日期"},on:{click:function(e){t.timeShowPicker=!0}}}),a("van-field",{attrs:{label:"供应商ID/名称",placeholder:"点击输入供应商ID/名称","input-align":"right",clearable:""},model:{value:t.filterObj.supplier,callback:function(e){t.$set(t.filterObj,"supplier",e)},expression:"filterObj.supplier"}}),a("van-field",{attrs:{label:"排序类型",placeholder:"点击选择排序类型","input-align":"right",readonly:"",clearable:""},on:{click:t.showSortTypePopup},model:{value:t.filterObj.sortType,callback:function(e){t.$set(t.filterObj,"sortType",e)},expression:"filterObj.sortType"}}),a("div",{staticClass:"d-flex justify-center mt-4 mb-5"},[a("van-button",{staticClass:"popup-button mr-3",attrs:{round:""},on:{click:t.refreshFilter}},[t._v("重置")]),a("van-button",{staticClass:"popup-button",attrs:{round:"",type:"info"},on:{click:t.handleFilter}},[t._v("确认")])],1)],1),a("van-popup",{attrs:{round:"",position:"bottom"},model:{value:t.showSortPopup,callback:function(e){t.showSortPopup=e},expression:"showSortPopup"}},[a("van-picker",{attrs:{"show-toolbar":"",columns:t.sortTypes},on:{confirm:t.onSortConfirm,cancel:function(e){t.showSortPopup=!1}}})],1),a("van-popup",{attrs:{position:"bottom",round:""},model:{value:t.showDeptPicker,callback:function(e){t.showDeptPicker=e},expression:"showDeptPicker"}},[t.showDeptPicker?a("van-picker",{attrs:{"show-toolbar":"",title:"选择平衡毛利单位",columns:t.departments.map((function(t){return t.deptName}))},on:{confirm:t.onDeptConfirm,cancel:t.onDeptCancel}}):t._e()],1),a("van-popup",{attrs:{position:"bottom",round:""},model:{value:t.timeShowPicker,callback:function(e){t.timeShowPicker=e},expression:"timeShowPicker"}},[a("van-picker",{attrs:{"show-toolbar":"",title:"选择年月",columns:t.dateColumns},on:{confirm:t.onDateConfirm,cancel:function(e){t.timeShowPicker=!1},change:t.onPickerChange}})],1),a("div",{staticClass:"px-2 background-color-white mb-2"},[a("div",{staticClass:"d-flex px-2 pt-3"},[a("div",{staticClass:"flex-1 pr-2"},[a("div",{staticClass:"card"},[a("div",{staticClass:"title"},[t._v("平衡毛利（万元）")]),a("div",{staticClass:"change"},[a("i",{class:t.getTrendIconClass(t.generalData.phmltb)}),a("span",{class:t.getChangeClass(t.generalData.phmltb)},[t._v(t._s(Math.abs(t.generalData.phmltb))+"% ")])]),a("div",{staticClass:"value"},[t._v(t._s(t.generalData.phml||"-"))])])]),a("div",{staticClass:"flex-1"},[a("div",{staticClass:"card"},[a("div",{staticClass:"title"},[t._v("基础毛利率")]),a("div",{staticClass:"change"},[a("i",{class:t.getTrendIconClass(t.generalData.jcmlltb)}),a("span",{class:t.getChangeClass(t.generalData.jcmlltb)},[t._v(t._s(Math.abs(t.generalData.jcmlltb))+"% ")])]),a("div",{staticClass:"value"},[t._v(t._s(t.generalData.jcmll)+"%")])])])]),a("div",{staticClass:"d-flex px-2 pt-2 pb-3"},[a("div",{staticClass:"flex-1 pr-2"},[a("div",{staticClass:"card"},[a("div",{staticClass:"title"},[t._v("整体销售（万元）")]),a("div",{staticClass:"change"},[a("i",{class:t.getTrendIconClass(t.generalData.wsxstb)}),a("span",{class:t.getChangeClass(t.generalData.wsxstb)},[t._v(" "+t._s(Math.abs(t.generalData.wsxstb))+"% ")])]),a("div",{staticClass:"value"},[t._v(t._s(t.generalData.wsxs||"-"))])])]),a("div",{staticClass:"flex-1"},[a("div",{staticClass:"card"},[a("div",{staticClass:"title"},[t._v("平衡毛利率")]),a("div",{staticClass:"change"},[a("i",{class:t.getTrendIconClass(t.generalData.phmlltb)}),a("span",{class:t.getChangeClass(t.generalData.phmlltb)},[t._v(" "+t._s(Math.abs(t.generalData.phmlltb))+"% ")])]),a("div",{staticClass:"value"},[t._v(t._s(t.generalData.phmll)+"%")])])])])]),a("div",{staticClass:"table-div"},[a("div",{directives:[{name:"show",rawName:"v-show",value:0==t.listItems.length&&!t.filterParams.loading,expression:"listItems.length == 0 && !filterParams.loading"}],staticClass:"white-block pb-3 mb-4"},[a("app-empty",{staticClass:"py-7",attrs:{description:"暂无数据"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.filterParams.loading,expression:"filterParams.loading"}],staticClass:"d-flex py-8 justify-center align-center"},[a("van-loading",{attrs:{type:"spinner",color:"#1989fa"}})],1),a("div",{staticClass:"table-body background-color-white mt-2"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.listItems.length>0,expression:"listItems.length > 0"}],staticClass:"table-line d-flex font-14 color-gray-5 lineHeight-20 align-center py-3"},[a("div",{staticClass:"table-div-1"},[t._v("供应商ID/供应商名称")]),a("div",{staticClass:"table-div-2"},[t._v("平衡毛利(万元)")]),a("div",{staticClass:"table-div-3"},[t._v("平衡毛利率")]),a("div",{staticClass:"table-div-4"},[t._v("无税销售(万元)")]),a("div",{staticClass:"table-div-5"},[t._v("基础毛利率")]),a("div",{staticClass:"table-div-5"},[t._v("上游付款天数")]),a("div",{staticClass:"table-div-6"},[t._v("库存周转天数")]),a("div",{staticClass:"table-div-7"},[t._v("下游回款天数")]),a("div",{staticClass:"table-div-8"},[t._v("采购银行承兑比例")]),a("div",{staticClass:"table-div-9"},[t._v(t._s("968"==t.deptId?"电商及战采销售占比":"内部零售及批发销售占比"))])]),t.listItems.length>0?a("div",{staticClass:"table-content"},t._l(t.listItems,(function(e,s){return a("div",{key:s+"pz",staticClass:"table-line d-flex font-14 color-black-2 lineHeight-20 align-center py-3",style:s%2===0?"background-color: #F7F7F7":"",on:{click:function(a){return t.handleItemClick(e)}}},[a("div",{staticClass:"table-div-1"},[t._v(t._s(e.supplyId)+"/"+t._s(e.supplyName))]),a("div",{staticClass:"table-div-2"},[t._v(t._s(e.phml))]),a("div",{staticClass:"table-div-3"},[t._v(t._s(e.phmll)+"%")]),a("div",{staticClass:"table-div-4"},[t._v(t._s(e.wsxs))]),a("div",{staticClass:"table-div-5"},[t._v(t._s(e.jcmll?e.jcmll:"-")+"%")]),a("div",{staticClass:"table-div-5"},[t._v(t._s(e.syfkts?e.syfkts:"-"))]),a("div",{staticClass:"table-div-6"},[t._v(t._s(e.kczzts?e.kczzts:"-"))]),a("div",{staticClass:"table-div-7"},[t._v(t._s(e.xyhkts?e.xyhkts:"-"))]),a("div",{staticClass:"table-div-8"},[t._v(t._s(e.cgcdbl?e.cgcdbl:"-")+"%")]),a("div",{staticClass:"table-div-9"},[t._v(t._s("968"==t.deptId?e.dsjzcxszb:e.nblsjpfxszb)+"%")])])})),0):t._e()]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.listItems.length>0,expression:"listItems.length > 0"}],staticClass:"py-4 background-color-white"},[a("van-pagination",{attrs:{"force-ellipses":!0,"total-items":t.filterParams.total,"items-per-page":t.filterParams.pageSize},on:{change:t.updatePagedData},scopedSlots:t._u([{key:"prev-text",fn:function(){return[a("van-icon",{attrs:{name:"arrow-left"}})]},proxy:!0},{key:"next-text",fn:function(){return[a("van-icon",{attrs:{name:"arrow"}})]},proxy:!0},{key:"page",fn:function(e){var a=e.text;return[t._v(t._s(a))]}}]),model:{value:t.filterParams.currentPage,callback:function(e){t.$set(t.filterParams,"currentPage",e)},expression:"filterParams.currentPage"}})],1)])],1)},i=[],l=a("1da1"),r=a("3835"),n=a("d4ec"),c=a("bee2"),o=a("262e"),p=a("2caf"),d=(a("96cf"),a("4de4"),a("d3b7"),a("159b"),a("4e82"),a("d81d"),a("4fadc"),a("caad"),a("2532"),a("7db0"),a("ac1f"),a("5319"),a("99af"),a("4d90"),a("b680"),a("fb6a"),a("466d"),a("9ab4")),u=a("1b40"),h=a("5b92"),m=a("2279"),v=a("b32d"),f=function(t){Object(o["a"])(a,t);var e=Object(p["a"])(a);function a(){var t;return Object(n["a"])(this,a),t=e.apply(this,arguments),t.dateTime="",t.deptName=t.$route.query.deptName,t.deptId=t.$route.query.deptId,t.showFilter=!1,t.filterActive=!0,t.showSortPopup=!1,t.timeShowPicker=!1,t.showDeptPicker=!1,t.departments=[],t.dateColumns=[],t.availableDate=[],t.filterObj={deptId:"",deptName:"",date:"",supplier:"",sortType:"平衡毛利倒序"},t.generalData={},t.filterParams={total:0,currentPage:1,pageSize:10,allData:[],loading:!1},t.allDepts=[{deptId:968,deptName:"英特药业"},{deptId:974,deptName:"英特电商"},{deptId:998,deptName:"宁波英特"},{deptId:984,deptName:"温州英特"},{deptId:985,deptName:"台州英特"},{deptId:990,deptName:"嘉兴英特"},{deptId:991,deptName:"嘉信医药"},{deptId:992,deptName:"湖州英特"},{deptId:993,deptName:"绍兴英特"},{deptId:994,deptName:"金华英特"},{deptId:995,deptName:"浦江英特"},{deptId:996,deptName:"丽水英特"},{deptId:997,deptName:"英特海斯"},{deptId:999,deptName:"明州英特"},{deptId:1e3,deptName:"舟山卫盛"},{deptId:1001,deptName:"淳安英特"},{deptId:1002,deptName:"英特盛健"},{deptId:1042,deptName:"英特生物"}],t.filterResult="",t.sortTypes=[{text:"平衡毛利正序",value:"phmlAsc"},{text:"平衡毛利倒序",value:"phmlDesc"},{text:"平衡毛利率正序",value:"phmllAsc"},{text:"平衡毛利率倒序",value:"phmllDesc"},{text:"无税金额正序",value:"wsxsAsc"},{text:"无税金额倒序",value:"wsxsDesc"},{text:"基础毛利率正序",value:"jcmllAsc"},{text:"基础毛利率倒序",value:"jcmllDesc"}],t.listItems=[],t}return Object(c["a"])(a,[{key:"transformData",value:function(t){var e={},a=t.filter((function(t){return!(2025===t.year&&5===t.month)}));return a.forEach((function(t){var a=t.year,s=t.month;e[a]||(e[a]=[]),e[a].push(s)})),Object.entries(e).map((function(t){var e=Object(r["a"])(t,2),a=e[0],s=e[1];return{year:parseInt(a,10),month:s.sort((function(t,e){return t-e}))}})).sort((function(t,e){return t.year-e.year}))}},{key:"showDeptPickerPopup",value:function(){var t=JSON.parse(localStorage.getItem("phmlArray")||"[]");this.departments=this.allDepts.filter((function(e){return t.includes(e.deptName)})),this.showDeptPicker=!0}},{key:"onDeptConfirm",value:function(t){var e=this.allDepts.find((function(e){return e.deptName===t}));e&&(this.filterObj.deptId=e.deptId,this.filterObj.deptName=e.deptName,this.deptId=e.deptId,this.updateDateColumns(),this.filterObj.date=""),this.showDeptPicker=!1}},{key:"onDeptCancel",value:function(){this.showDeptPicker=!1}},{key:"initDateColumns",value:function(){var t=this.availableDate.map((function(t){return"".concat(t.year,"年1月至")})),e=this.availableDate[this.availableDate.length-1],a=e.month.map((function(t){return"".concat(t,"月")}));this.dateColumns=[{values:t,defaultIndex:t.length-1},{values:a,defaultIndex:a.length-1}]}},{key:"titleDateRange",get:function(){var t=this.$dayjs(this.dateTime),e=this.$dayjs(),a=t;return t.isSame(e,"month")&&(a=0===t.month()?t:t.subtract(1,"month")),{startYear:t.year(),startMonth:1,endYear:a.year(),endMonth:a.month()+1}}},{key:"onPickerChange",value:function(t,e,a){if(0===a){var s=parseInt(e[0].replace("年1月至",""),10),i=this.availableDate.find((function(t){return t.year===s}));if(i){var l=i.month.map((function(t){return"".concat(t,"月")}));t.setColumnValues(1,l),l.includes(e[1])||t.setColumnIndex(1,0)}}}},{key:"onDateConfirm",value:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.timeShowPicker=!1,this.filterObj.date="".concat(e[0]).concat(e[1]);case 2:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"updateDateColumns",value:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(){var e,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(m["U"])({deptId:this.deptId});case 2:e=t.sent,e&&e.data&&(this.availableDate=this.transformData(e.data),a=this.availableDate[this.availableDate.length-1],s=a.month[a.month.length-1],this.dateTime="".concat(a.year,"-").concat(String(s).padStart(2,"0"),"-01"),this.initDateColumns());case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"mounted",value:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.updateDateColumns();case 2:return this.filterObj.sortType="平衡毛利倒序",t.next=5,this._querySupplierAll();case 5:return t.next=7,this.fetchSupplierList("");case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getChangeClass",value:function(t){return t>0?"increase":t<0?"decrease":"no-change"}},{key:"getTrendIconClass",value:function(t){return t>0?"rank-up-icon":t<0?"rank-down-icon":"rank-line-icon"}},{key:"fetchSupplierList",value:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(e){var a,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a={deptId:this.deptId,end:this.dateTime,start:this.$dayjs(this.dateTime).startOf("year").format("YYYY-MM-DD"),search:e,type:1},t.next=4,Object(m["jb"])(a);case 4:s=t.sent,s.data&&(this.filterParams.allData=s.data.map((function(t){return{supplyId:t.supplyId,supplyName:t.supplyName,phml:Object(h["b"])(t.phml),phmll:t.phmll?t.phmll.toFixed(2):"-",wsxs:Object(h["b"])(t.wsxs),jcmll:t.jcmll?t.jcmll.toFixed(2):"-",syfkts:Math.round(t.syfkts),kczzts:Math.round(t.kczzts),xyhkts:Math.round(t.xyhkts),cgcdbl:t.cgcdbl?t.cgcdbl.toFixed(2):"-",dsjzcxszb:t.dsjzcxszb?t.dsjzcxszb.toFixed(2):"-",nblsjpfxszb:t.nblsjpfxszb?t.nblsjpfxszb.toFixed(2):"-"}})),this.filterParams.total=this.filterParams.allData.length,i=this.filterObj.sortType,"平衡毛利正序"===i?this.filterParams.allData.sort((function(t,e){return t.phml-e.phml})):"平衡毛利倒序"===i?this.filterParams.allData.sort((function(t,e){return e.phml-t.phml})):"平衡毛利率正序"===i?this.filterParams.allData.sort((function(t,e){return parseFloat(t.phmll)-parseFloat(e.phmll)})):"平衡毛利率倒序"===i?this.filterParams.allData.sort((function(t,e){return parseFloat(e.phmll)-parseFloat(t.phmll)})):"无税金额正序"===i?this.filterParams.allData.sort((function(t,e){return t.wsxs-e.wsxs})):"无税金额倒序"===i?this.filterParams.allData.sort((function(t,e){return e.wsxs-t.wsxs})):"基础毛利率正序"===i?this.filterParams.allData.sort((function(t,e){return parseFloat(t.jcmll)-parseFloat(e.jcmll)})):"基础毛利率倒序"===i&&this.filterParams.allData.sort((function(t,e){return parseFloat(e.jcmll)-parseFloat(t.jcmll)})),this.updatePagedData()),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0);case 11:case"end":return t.stop()}}),t,this,[[0,8]])})));function e(e){return t.apply(this,arguments)}return e}()},{key:"updatePagedData",value:function(){var t=(this.filterParams.currentPage-1)*this.filterParams.pageSize,e=t+this.filterParams.pageSize;this.listItems=this.filterParams.allData.slice(t,e)}},{key:"_querySupplierAll",value:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e={type:0,deptId:this.deptId,supplierId:"",end:this.dateTime,start:this.$dayjs(this.dateTime).startOf("year").format("YYYY-MM-DD")},t.next=3,Object(m["hb"])(e);case 3:a=t.sent,a.data&&(this.generalData={phml:Object(h["b"])(a.data.phml),phmltb:null!=a.data.phmltb?a.data.phmltb.toFixed(2):"-",phmll:null!=a.data.phmll?a.data.phmll.toFixed(2):"-",phmlltb:null!=a.data.phmlltb?a.data.phmlltb.toFixed(2):"-",wsxs:Object(h["b"])(a.data.wsxs),wsxstb:null!=a.data.wsxstb?a.data.wsxstb.toFixed(2):"-",jcmll:null!=a.data.jcmll?a.data.jcmll.toFixed(2):"-",jcmlltb:null!=a.data.jcmlltb?a.data.jcmlltb.toFixed(2):"-"});case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"showPopup",value:function(){this.showFilter=!this.showFilter}},{key:"closePupup",value:function(){this.filterObj={deptId:"",deptName:"",date:"",supplier:"",sortType:""},this.showFilter=!1}},{key:"refreshFilter",value:function(){this.filterObj={deptId:"",deptName:"",date:"",supplier:"",sortType:""},this.filterActive=!1,this.filterResult=""}},{key:"handleFilter",value:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(){var e,a,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.filterObj.deptName&&(this.deptName=this.filterObj.deptName),this.filterObj.date&&(e=this.filterObj.date.match(/(\d{4})年/),a=this.filterObj.date.match(/至(\d{1,2})月/),e&&a&&(s=e[1],i=a[1].padStart(2,"0"),this.dateTime="".concat(s,"-").concat(i,"-01"))),this.filterObj.deptId&&(this.deptId=this.filterObj.deptId),this.filterObj.sortType||(this.filterObj.sortType="平衡毛利倒序"),this.filterResult=this.filterObj.supplier,this.filterParams.currentPage=1,this.filterObj.deptName||this.filterObj.date||this.filterObj.supplier||this.filterObj.sortType?this.filterActive=!0:this.filterActive=!1,t.next=9,this.fetchSupplierList(this.filterObj.supplier);case 9:return t.next=11,this._querySupplierAll();case 11:this.showFilter=!1;case 12:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"handleItemClick",value:function(t){this.$router.push({name:"BalanceGrossDetail",query:{deptId:this.deptId,supplyId:t.supplyId,filterResult:this.filterResult,dateTime:this.dateTime}})}},{key:"showSortTypePopup",value:function(){this.showSortPopup=!0}},{key:"onSortConfirm",value:function(t){var e=this.sortTypes.find((function(e){return e.text===t.text}));e&&(this.filterObj.sortType=e.text),this.showSortPopup=!1}},{key:"destroyed",value:function(){Object(v["b"])()}}]),a}(u["d"]);f=Object(d["a"])([Object(u["a"])({name:"BalanceGrossIndex",components:{}})],f);var b=f,g=b,y=(a("e56a"),a("2877")),w=Object(y["a"])(g,s,i,!1,null,"f69a74d6",null);e["default"]=w.exports},e56a:function(t,e,a){"use strict";a("3297")}}]);