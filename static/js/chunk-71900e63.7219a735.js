(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-71900e63"],{"44b5":function(e,t,s){"use strict";s("76fa")},"76fa":function(e,t,s){},"96c7":function(e,t,s){"use strict";s("d4db")},a0eb:function(e,t,s){},cefc:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"customerFollow"},[s("van-sticky",[s("div",{staticClass:"customerFollow-header d-flex pt-3 px-3"},[s("div",{staticClass:"flex-5 pl-3 white-bg",on:{click:e.changeDate}},[s("span",{staticClass:"font-14"},[e._v(e._s(e.$dayjs(e.dateRange[0]).format("MM-DD"))+" ~ "+e._s(e.$dayjs(e.dateRange[1]).format("MM-DD")))]),e._v(" ("+e._s(e.$dayjs(e.dateRange[0]).format("YYYY年"))+") ")]),e.checkedUsers.length?s("div",{staticClass:"flex-3 textAlignC font-14 mx-2 background-color-main-2",staticStyle:{color:"white"},on:{click:e.getUsersClick}},[e._v(" 已选"+e._s(e.checkedUsers.length)+"人 ")]):s("div",{staticClass:"flex-3 textAlignC font-14 mx-2 white-bg",on:{click:e.getUsersClick}},[e._v(" 我的客情"),e.depTreeList.length?s("van-icon",{staticClass:"ml-1",attrs:{name:"arrow-down"}}):e._e()],1),s("div",{staticClass:"flex-2 textAlignC white-bg"},[s("span",{staticClass:"customerFollow-header-number",style:0===e.numberObj.numberAll?"background: #d8d8d8":""},[e._v(e._s(e.numberObj.numberAll||"0"))]),s("span",{staticClass:"pl-1"},[s("van-icon",{attrs:{color:"#FBD71B",name:0===e.numberObj.numberStar?"star-o":"star"}}),e._v(e._s(e.numberObj.numberStar||"0"))],1)])])]),s("div",{staticClass:"customerFollow-list pt-2 px-3"},[s("van-pull-refresh",{on:{refresh:e.onRefresh},model:{value:e.refreshing,callback:function(t){e.refreshing=t},expression:"refreshing"}},[s("van-list",{staticClass:"pb-100",attrs:{offset:20,finished:e.finished,"finished-text":e.finishText},on:{load:e.onLoad},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},[e.loading||e.dataList.length?e._e():s("app-empty",{staticClass:"pb-6 white-bg",attrs:{description:"暂无数据"}}),e._l(e.dataList,(function(t,a){return s("list",{key:a,attrs:{item:t},on:{listClick:e.listClick,addStarClick:e.addStarClick,editClick:e.editClick,clickChange:e.clickChange,commentClick:e.commentClick}})}))],2)],1)],1),s("div",{staticClass:"commonOpButton-footer"},[e.checkedUsers.length?s("van-button",{attrs:{round:"",color:"#2271F5",type:"primary"},on:{click:function(t){e.checkedUsers=[],e.userDataList=[],e.onRefresh()}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("icon-Svg",{attrs:{size:"small",color:"white",name:"ytcrm-juxing1"}})]},proxy:!0}])},[s("span",[e._v("本人客情")])]):s("van-button",{attrs:{round:"",color:"#2271F5",type:"primary"},on:{click:e.addClick},scopedSlots:e._u([{key:"icon",fn:function(){return[s("icon-Svg",{attrs:{size:"small",color:"white",name:"ytcrm-a-xingzhuang2"}})]},proxy:!0}],null,!1,780156825)},[s("span",[e._v("客情新增")])])],1),s("van-calendar",{attrs:{type:"range","default-date":e.dateRange,"min-date":new Date(2020,0,1),"first-day-of-week":"1",color:"#1989fa","show-confirm":!0},on:{confirm:e.calendarConfirm},model:{value:e.calendarShow,callback:function(t){e.calendarShow=t},expression:"calendarShow"}}),e.customerLabelShow?s("custom-label",{attrs:{activeName:0,customerLabelShow:e.customerLabelShow},on:{closeClick:function(t){e.customerLabelShow=!1}}}):e._e(),e.showAdressPicker?s("clock-in",{attrs:{detailClock:e.detailObj.cciId,visitDate:e.visitDate,showAdressPicker:e.showAdressPicker},on:{adressOnConfirm:e.adressOnConfirm,addressChoose:e.addressChoose,adressCancel:e.adressCancel}}):e._e(),e.commentShow?s("comment",{attrs:{commentShow:e.commentShow},on:{closeClick:function(t){e.commentShow=!1},sureComment:e.sureComment}}):e._e(),e.hasDept?s("dept-user",{ref:"deptUer",attrs:{show:e.changeTypeShow,loading:e.getUserListLoading,depTreeList:e.depTreeList,deptUserData:e.deptUserData,searchList:e.userDataList},on:{search:e.refreshUserByKeywords,refresh:e.refreshUserByDepts,confirm:e.onTreeConfirm,cancel:e.cancelUserByDepts}}):e._e()],1)},i=[],n=s("d4ec"),c=s("bee2"),r=s("262e"),o=s("2caf"),l=(s("4de4"),s("d3b7"),s("99af"),s("caad"),s("2532"),s("b0c0"),s("9ab4")),m=s("1b40"),d=s("d926"),u=s("53ae"),h=s("8393"),f=s("e7dd"),p=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.item?s("div",{staticClass:"list mb-3"},[s("div",{staticClass:"warp pa-2",on:{click:e.listClick}},[s("div",{staticClass:"list-header"},[s("div",{staticClass:"d-flex justify-space-between align-center"},[s("div",{staticClass:"d-flex align-center"},[s("span",{staticClass:"font-14 fontWeight"},[e._v(" "+e._s(e.item.companyName?e.item.companyName.indexOf("/").length>2?e.item.companyName.split("/")[0]+"/":e.item.companyName.substring(0,10):"")+" ")]),e.item.address?s("icon-svg",{staticClass:"ml-3",attrs:{size:"small",name:"ytcrm-tuding1"}}):e._e()],1),s("span",{staticClass:"color-second"},[e._v(e._s(e.item.visitTime.substring(0,16)))])]),s("div",{staticClass:"d-flex justify-space-between align-center"},[s("span",{staticStyle:{width:"70%"}},[s("span",{staticClass:"fontWeight font-14"},[e._v(" "+e._s(e.item.companyName?e.item.companyName.indexOf("/").length>2?e.item.companyName.split("/")[1]+"/"+e.item.companyName.split("/")[2]+"/":e.item.companyName.substring(10,e.item.companyName.length):"")+" ")]),s("span",{staticClass:"color-second"},[e._v(e._s(1===e.item.companyType?"供应商":2===e.item.companyType?"下游客户":3===e.item.companyType?"政府单位":""))])]),s("span",[e.item.isRaisedStarFlag?e._e():s("van-icon",{attrs:{size:"16px",name:"star-o",color:"#FBD71B"}}),e._l(e.item.starFlag,(function(e){return s("van-icon",{key:e,attrs:{size:"16px",name:"star",color:"#FBD71B"}})})),0===e.item.whetherLegwork?s("svg",{staticClass:"icon ml-1",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#ytcrm-xingzhuangjiehe"}})]):e._e(),1===e.item.whetherLegwork?s("svg",{staticClass:"icon ml-2",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#ytcrm-buhang"}})]):e._e(),s("span",{staticClass:"list-primaryColor ml-2"},[e._v(e._s(1===e.item.whetherLegwork?"":"非")+"外勤")])],2)]),s("div",{staticClass:"d-flex justify-space-between align-center my-2"},[s("span",[s("span",{staticClass:"fontWeight font-14"},[e._v(e._s(e.item.visitUserName))]),s("svg",{staticClass:"icon ml-1 pr-1",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":1===e.item.warmthNum?"#ytcrm-full-green":2===e.item.warmthNum?"#ytcrm-full-orange":3===e.item.warmthNum?"#ytcrm-full-red":""}})]),s("span",{staticClass:"color-second"},[e._v("（发起人："+e._s(e.item.creName)+"）")])]),s("span",{class:1===e.item.taskType?"tag-primary":2===e.item.taskType?"tag-primary-light":3===e.item.taskType?"tag-primary-plain":""},[e._v(e._s(1===e.item.taskType?"个人拜访":2===e.item.taskType?"协访":3===e.item.taskType?"接待":"")+" ")])])]),s("div",{staticClass:"list-content"},[s("div",{staticClass:"list-customer"},[s("div",{staticClass:"list-customer-title font-14 d-flex align-center"},[s("span",{staticClass:"color-second"},[e._v("客情事件信息")]),s("span",{staticClass:"font-10 px-1",class:e.item.crmLabelRemarkDtoList.length?"list-comment-acitve-number":"list-comment-number"},[e._v(e._s(e.item.crmLabelRemarkDtoList.length))])]),e.item.crmLabelRemarkDtoList.length?s("ul",{staticClass:"font-14 color-second mt-2 px-2"},[s("li",{staticClass:"pt-1 mr-1 slh"},e._l(e.item.crmLabelRemarkDtoList,(function(t,a){return s("span",{key:a},["药事会信息"===t.labelName?[e._v(" "+e._s(t.labelName)+"： "),t.medicBoardType?s("span",[e._v(" "+e._s(1===t.medicBoardType?"新药会":2===t.medicBoardType?"国谈会":3===t.medicBoardType?t.medicBoardTypeMemo:"")+" ")]):e._e(),t.medicBoardType&&(t.scheduleMeetingTime||t.medicBoardMemo)?s("span",[e._v("，")]):e._e(),t.scheduleMeetingTime?s("span",[e._v(e._s(t.scheduleMeetingTime?t.scheduleMeetingTime.split(" ")[0]:""))]):e._e(),t.scheduleMeetingTime&&t.medicBoardMemo?s("span",[e._v("，")]):e._e(),t.medicBoardMemo?s("span",[e._v(e._s(t.medicBoardMemo))]):e._e(),e._v(" ； ")]:[e._v(e._s(t.labelName)+"："+e._s(t.remark)+"；")]],2)})),0)]):e._e()]),s("div",{staticClass:"list-comment"},[s("div",{staticClass:"list-customer-title font-14 d-flex align-center"},[s("span",{staticClass:"color-second"},[e._v("批注信息")]),s("span",{staticClass:"font-10 px-1",class:e.item.crmVisitCommentDtoList.length?"list-comment-acitve-number":"list-comment-number "},[e._v(e._s(e.item.crmVisitCommentDtoList.length))])])])])]),s("div",{staticClass:"list-button d-flex align-center justify-space-between px-2 py-1"},[s("div",{staticClass:"d-flex align-center"},[e.item.isRaisedStarFlag?e._e():s("van-icon",{attrs:{size:"20px",name:"star-o",color:"#2271F5"},on:{click:function(t){return e.addStarClick(e.item)}}}),e.item.isRaisedStarFlag?s("van-icon",{attrs:{size:"20px",name:"star",color:"#FBD71B"}}):e._e(),s("icon-svg",{directives:[{name:"show",rawName:"v-show",value:e.userInfor.userId===e.item.creId,expression:"userInfor.userId === item.creId"}],staticClass:"mx-6 cursorP",attrs:{size:"large",name:"ytcrm-tuding"},nativeOn:{click:function(t){return e.clickChange.apply(null,arguments)}}}),s("icon-svg",{directives:[{name:"show",rawName:"v-show",value:e.userInfor.userId===e.item.creId,expression:"userInfor.userId === item.creId"}],attrs:{size:"width:16px;height:20px;fill:#2271F5;",name:"ytcrm-lujing2"},nativeOn:{click:function(t){return e.editClick.apply(null,arguments)}}})],1),s("van-button",{staticClass:"mr-2",staticStyle:{height:"30px"},attrs:{size:"small",color:"#2271F5",round:"",type:"info"},on:{click:e.commentClick}},[e._v("批注")])],1)]):e._e()},v=[],b=s("4bb5"),g=Object(b["a"])("app"),k=function(e){Object(r["a"])(s,e);var t=Object(o["a"])(s);function s(){return Object(n["a"])(this,s),t.apply(this,arguments)}return Object(c["a"])(s,[{key:"listClick",value:function(){this.$emit("listClick",this.item)}},{key:"addStarClick",value:function(){this.$emit("addStarClick",this.item)}},{key:"editClick",value:function(){this.$emit("editClick",this.item)}},{key:"clickChange",value:function(){this.$emit("clickChange",this.item)}},{key:"commentClick",value:function(){this.$emit("commentClick",this.item)}}]),s}(m["d"]);Object(l["a"])([g.Getter],k.prototype,"userInfor",void 0),Object(l["a"])([Object(m["c"])()],k.prototype,"item",void 0),k=Object(l["a"])([Object(m["a"])({})],k);var y=k,C=y,O=(s("44b5"),s("2877")),_=Object(O["a"])(C,p,v,!1,null,"557d0dae",null),w=_.exports,j=s("e906"),D=function(e){Object(r["a"])(s,e);var t=Object(o["a"])(s);function s(){var e;return Object(n["a"])(this,s),e=t.apply(this,arguments),e.nowDay=e.$dayjs(),e.changeDay=e.$dayjs().format("YYYY-MM-DD"),e.dateRange=[],e.calendarShow=!1,e.reLoad=!0,e.numberObj={numberAll:0,numberStart:0},e}return Object(c["a"])(s,[{key:"_dayText",value:function(){return Object(d["a"])(this.$dayjs(this.changeDay).day())}},{key:"dateChange",value:function(e){this.changeDay=e,this.init(e)}},{key:"changeDate",value:function(){this.calendarShow=!0}},{key:"selectCalendar",value:function(e){this.calendarConfirm(e)}},{key:"calendarConfirm",value:function(e){this.calendarShow=!1,this.dateRange=e,this.onRefresh(),this.reLoad=!1}},{key:"init",value:function(e){this.dateRange=[new Date(Object(d["k"])(e)),new Date(Object(d["b"])(e))],this.onRefresh(),this.reLoad=!1}},{key:"onRefresh",value:function(){this.finished=!1,this.loading=!0,this.page=1,this.onLoad()}},{key:"onLoad",value:function(){this.refreshing&&(this.page=1,this.dataList=[],this.refreshing=!1),this._getDataList()}},{key:"getNumber",value:function(){this.numberObj.numberStar=this.dataList.filter((function(e){return e.isRaisedStarFlag})).length,this.numberObj.numberAll=this.dataList.length}},{key:"_getDataList",value:function(){var e=this;1===this.page&&(this.dataList=[]),this.loading=!0;var t={startTime:this.$dayjs(this.dateRange[0]).format("YYYY-MM-DD")+" 00:00:00",endTime:this.$dayjs(this.dateRange[1]).format("YYYY-MM-DD")+" 23:59:59",pageNum:this.page,pageSize:8,userIdList:this.checkedUsers};Object(j["e"])(t).then((function(t){"200"===t.code?(e.dataList=t.data.list.length>0?e.dataList.concat(t.data.list):e.dataList,e.getNumber(),t.data.hasNextPage?e.page++:e.finished=!0):e.finished=!0,e.loading=!1}))}},{key:"addClick",value:function(){this.SET_DETAILOBJ({staffMemberCheckDetail:[]}),this.$router.push({name:"customerFollowAdd"})}},{key:"listClick",value:function(e){this.SET_DETAILOBJ(e),this.$router.push({name:"customerFollowDetail"})}},{key:"onTreeConfirm",value:function(e){var t=this;this.checkedUsers=e;var s=this.userDataList.filter((function(t){return e.includes(t.userId)}));this.checkDetailList=this.checkDetailList.concat(s);for(var a=[],i=function(s){var i=t.checkDetailList[s];-1===e.indexOf(i.userId)||a.some((function(e){return i.userId===e.userId}))||a.push(i)},n=0;n<this.checkDetailList.length;n++)i(n);this.checkDetailList=a,this.changeTypeShow=!1,this.onRefresh()}},{key:"mounted",value:function(){this.init(this.nowDay)}},{key:"activated",value:function(){"add"===this.dataChangeOp&&(this.onRefresh(),this.SET_DATACHANGEOP(""))}},{key:"onCartShow",value:function(){var e=this;!0===this.dataChangeOp&&(this.dataList.filter((function(t){t.cuvId===e.detailObj.cuvId&&(e.$set(t,"crmLabelRemarkDtoList",e.detailObj.crmLabelRemarkDtoList),e.$set(t,"crmVisitCommentDtoList",e.detailObj.crmVisitCommentDtoList),e.$set(t,"address",e.detailObj.address),e.$set(t,"cciId",e.detailObj.cciId))})),this.SET_DATACHANGEOP(""))}}]),s}(Object(m["b"])(u["a"],h["a"],f["a"]));Object(l["a"])([Object(m["e"])("detailObj",{deep:!0})],D.prototype,"onCartShow",null),D=Object(l["a"])([Object(m["a"])({components:{list:w},beforeRouteEnter:function(e,t,s){s((function(e){"CrmIndex"===t.name&&e.init()}))}})],D);var L=D,S=L,x=(s("96c7"),Object(O["a"])(S,a,i,!1,null,"547333c6",null));t["default"]=x.exports},d4db:function(e,t,s){},d54e:function(e,t,s){"use strict";s("a0eb")},e7dd:function(e,t,s){"use strict";var a=s("1da1"),i=s("2909"),n=s("d4ec"),c=s("bee2"),r=s("262e"),o=s("2caf"),l=(s("96cf"),s("e9c4"),s("99af"),s("9ab4")),m=s("1b40"),d=s("e906"),u=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("van-popup",{style:{width:"100%",height:"40%"},attrs:{position:"bottom",round:"",clearable:""},on:{close:e.closeClick},model:{value:e.innCommentShow,callback:function(t){e.innCommentShow=t},expression:"innCommentShow"}},[s("div",{staticClass:"font-16 fontWeight-500 textAlignC pt-4 pb-2"},[e._v("批注")]),s("van-field",{staticStyle:{height:"calc(100% - 100px)"},attrs:{autosize:"",label:"",type:"textarea",placeholder:"请输入批注","show-word-limit":""},model:{value:e.commentMessage,callback:function(t){e.commentMessage=t},expression:"commentMessage"}}),s("div",{staticClass:"footer full-width d-flex align-center justify-end"},[s("span",{staticClass:"color-main-2 font-14 px-4",on:{click:e.sureComment}},[e._v(" 提交 ")])])],1)},h=[],f=function(e){Object(r["a"])(s,e);var t=Object(o["a"])(s);function s(){var e;return Object(n["a"])(this,s),e=t.apply(this,arguments),e.innCommentShow=!1,e.commentMessage="",e}return Object(c["a"])(s,[{key:"closeClick",value:function(){this.$emit("closeClick")}},{key:"sureComment",value:function(){this.commentMessage?this.$emit("sureComment",this.commentMessage):this.$toast.fail("请输入批注内容")}},{key:"mounted",value:function(){this.innCommentShow=this.commentShow}}]),s}(m["d"]);Object(l["a"])([Object(m["c"])()],f.prototype,"commentShow",void 0),f=Object(l["a"])([Object(m["a"])({})],f);var p=f,v=p,b=(s("d54e"),s("2877")),g=Object(b["a"])(v,u,h,!1,null,"7c2d045c",null),k=g.exports,y=s("2efb"),C=s("3df5"),O=s("4bb5"),_=Object(O["a"])("crm"),w=Object(O["a"])("app"),j=function(e){Object(r["a"])(s,e);var t=Object(o["a"])(s);function s(){var e;return Object(n["a"])(this,s),e=t.apply(this,arguments),e.commentShow=!1,e.showAdressPicker=!1,e.customerLabelShow=!1,e}return Object(c["a"])(s,[{key:"addStarClick",value:function(e){var t=this;this.$dialog.confirm({title:"确认",confirmButtonColor:"#2271f5",message:"确定要将当前拜访记录提升为星标事件吗？"}).then((function(){Object(d["n"])({cuvId:e.cuvId}).then((function(s){"200"===s.code?(t.$toast({type:"success",message:s.msg}),t.$set(e,"isRaisedStarFlag",!0),t.$set(e,"starFlag",e.starFlag++)):t.$toast.fail(s.msg)}))}))}},{key:"editClick",value:function(e){var t=[],s={userId:e.visitUserId,userName:e.visitUserName,phoneNumber:e.visitUserPhoneNum,hotid:e.warmthNum,starCheck:0,outsideCheck:e.address?1:0,hotValue:1===+e.warmthNum?"业务员一般客情":2===+e.warmthNum?"需要进阶的客情":3===+e.warmthNum?"从未接触的客情":"请选择热力值信息",remarkValueList:Object(i["a"])(e.crmLabelRemarkDtoList),needLabelValueObj:[]};t.push(JSON.parse(JSON.stringify(s))),e.staffMemberCheckDetail=t,this.SET_DETAILOBJ(e),this.customerLabelShow=!0}},{key:"commentClick",value:function(e){this.SET_DETAILOBJ(e),this.commentShow=!0}},{key:"sureComment",value:function(e){var t=[{commentRemark:e,cuvId:this.detailObj.cuvId,cvcId:this.detailObj.cvcId,creName:this.userInfor.userName,credate:this.$dayjs().format("YYYY-MM-DD HH:mm")}];this._insOrUpdComment(t)}},{key:"_insOrUpdComment",value:function(e){var t=this;Object(d["f"])(e).then((function(s){if("200"===s.code){t.$toast({type:"success",message:s.msg});var a=JSON.parse(JSON.stringify(t.detailObj));t.$set(a,"crmVisitCommentDtoList",a.crmVisitCommentDtoList.concat(e)),t.SET_DETAILOBJ(a),t.SET_DATACHANGEOP(!0),t.commentShow=!1}}))}},{key:"clickChange",value:function(e){this.SET_DETAILOBJ(e),this.showAdressPicker=!0}},{key:"adressOnConfirm",value:function(e){this._relateClockIn({cciId:e.cciId,cuvId:this.detailObj.cuvId},e),this.showAdressPicker=!1}},{key:"_relateClockIn",value:function(e,t){var s=this;Object(d["o"])(e).then((function(e){if("200"===e.code){s.$toast.success(e.msg);var a=JSON.parse(JSON.stringify(s.detailObj));s.$set(a,"address",t.address||t.addressDetail),s.$set(a,"cciId",t.cciId||t.addressID),s.SET_DETAILOBJ(a),s.SET_DATACHANGEOP(!0),s.showAdressPicker=!1}else s.$toast.fail(e.msg)}))}},{key:"addressChoose",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this._relateClockIn({cciId:t.addressID,cuvId:this.detailObj.cuvId},t),this.showAdressPicker=!1;case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"adressCancel",value:function(){this.showAdressPicker=!1}}]),s}(m["d"]);Object(l["a"])([_.Mutation],j.prototype,"SET_DETAILOBJ",void 0),Object(l["a"])([w.Getter],j.prototype,"userInfor",void 0),Object(l["a"])([_.Getter],j.prototype,"detailObj",void 0),Object(l["a"])([_.Getter],j.prototype,"dataChangeOp",void 0),Object(l["a"])([_.Mutation],j.prototype,"SET_DATACHANGEOP",void 0),j=Object(l["a"])([Object(m["a"])({components:{comment:k,clockIn:y["a"],customLabel:C["a"]}})],j);t["a"]=j}}]);