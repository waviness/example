(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6619d392"],{"08de":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("van-popup",{staticClass:"full-height d-flex flex-column",attrs:{position:"top"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[s("van-search",{attrs:{placeholder:"搜索","input-align":"center"},on:{input:e.onInput},model:{value:e.keywords,callback:function(t){e.keywords=t},expression:"keywords"}}),e.keywords?s("div",{staticClass:"flex-1 overflow-y-auto"},[e.isSelect&&e.searchList.length?s("van-checkbox-group",{ref:"checkboxGroup",model:{value:e.checkedIdList,callback:function(t){e.checkedIdList=t},expression:"checkedIdList"}},e._l(e.searchList,(function(t,a){return s("van-checkbox",{key:a,staticClass:"font-14 font-bold mx-4 my-3",attrs:{"icon-size":"16px","checked-color":"#2271F5",name:t.userId}},[e._v(e._s(t.userName))])})),1):e._e(),!e.isSelect&&e.userDataList.length?s("van-radio-group",{model:{value:e.checkedId,callback:function(t){e.checkedId=t},expression:"checkedId"}},e._l(e.searchList,(function(t){return s("van-radio",{key:t.userId,ref:"checkboxes",refInFor:!0,staticClass:"font-14 font-bold mt-6",attrs:{"icon-size":"16px","checked-color":"#2271F5",name:t.userId}},[e._v(e._s(t.userName))])})),1):e._e(),e.searchList.length||e.loading?e._e():s("app-empty",{staticClass:"mt-7",attrs:{description:"暂无人员"}}),s("van-loading",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],attrs:{type:"spinner",color:"#2271F5"}})],1):[s("div",{staticClass:"font-14 color-main-2 px-4 py-1 tree-shadow"},e._l(e.breadList,(function(t,a){return s("span",{key:t.depId,on:{click:function(s){return e.changeBread(t,a)}}},[e._v(e._s(t.depName)),s("van-icon",{attrs:{name:"arrow"}})],1)})),0),s("div",{staticClass:"flex-1 d-flex px-4 py-3 overflow-hidden"},[s("div",{staticClass:"flex-2 full-height"},[s("van-collapse",{staticClass:"dep-collapse",attrs:{border:!1},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[s("van-collapse-item",{attrs:{title:e.curDeptObj.depName,name:"1","label-class":"pa-0",border:!1}},e._l(e.curDeptObj.childList,(function(t){return s("div",{key:t.depId,staticClass:"d-flex align-center justify-space-between mt-3 mb-6",on:{click:function(s){return e.changeDept(t)}}},[s("div",{staticClass:"color-black-2"},[e._v(e._s(t.depName))]),s("van-icon",{staticClass:"font-16",attrs:{name:"arrow-down"}})],1)})),0)],1)],1),s("div",{staticClass:"tree-div__line"}),s("div",{staticClass:"flex-1 full-height pl-4 overflow-y-auto"},[e.isSelect?s("div",{staticClass:"color-main-2 font-14",on:{click:e.onAllCheckClick}},[e._v(" "+e._s(e.selectAll?"取消全选":"全选")+" ")]):e._e(),e.isSelect&&e.userDataList.length?s("van-checkbox-group",{ref:"checkboxGroup",model:{value:e.checkedIdList,callback:function(t){e.checkedIdList=t},expression:"checkedIdList"}},e._l(e.userDataList,(function(t){return s("van-checkbox",{key:t.userId,ref:"checkboxes",refInFor:!0,staticClass:"font-14 font-bold mt-6",attrs:{"icon-size":"16px","checked-color":"#2271F5",name:t.userId}},[e._v(e._s(t.userName))])})),1):e._e(),!e.isSelect&&e.userDataList.length?s("van-radio-group",{model:{value:e.checkedId,callback:function(t){e.checkedId=t},expression:"checkedId"}},e._l(e.userDataList,(function(t){return s("van-radio",{key:t.userId,ref:"checkboxes",refInFor:!0,staticClass:"font-14 font-bold mt-6",attrs:{"icon-size":"16px","checked-color":"#2271F5",name:t.userId}},[e._v(e._s(t.userName))])})),1):e._e(),e.userDataList.length||e.loading?e._e():s("app-empty",{staticClass:"mt-7",attrs:{description:"暂无人员",size:"100px"}}),s("van-loading",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],attrs:{type:"spinner",color:"#2271F5"}})],1)])],s("div",{staticClass:"d-flex align-center px-4 py-10",staticStyle:{background:"#f7f8fa"}},[e.isSelect?s("div",{staticClass:"flex-1 color-main-2 font-14 d-flex align-center",on:{click:function(t){e.checkedShow=!0}}},[e._v(" 已选"+e._s(e.allCheckedList.length)+"人 "),s("van-icon",{staticClass:"ml-3",attrs:{name:"arrow-"+(e.checkedShow?"up":"down"),size:"16px"}})],1):e._e(),e.isSelect?e._e():s("div",{staticClass:"flex-1 color-main-2 font-14 d-flex align-center"}),s("van-button",{staticStyle:{width:"72px"},attrs:{size:"small",block:"",round:""},on:{click:e.cancel}},[e._v("取消")]),s("van-button",{staticClass:"ml-4",staticStyle:{width:"72px"},attrs:{type:"info",size:"small",block:"",round:"",color:"#3561F2"},on:{click:e.onTreeConfirm}},[e._v("确认")])],1),s("van-popup",{style:{height:"60%"},attrs:{position:"bottom",round:"",closeable:""},model:{value:e.checkedShow,callback:function(t){e.checkedShow=t},expression:"checkedShow"}},[s("div",{staticClass:"font-16 font-bold textAlignC my-3"},[e._v("已选"+e._s(e.allCheckedList.length)+"人")]),s("div",{staticClass:"overflow-y-auto",staticStyle:{height:"calc(100% - 125px)"}},e._l(e.allCheckedList,(function(t){return s("van-cell",{key:t.userId,attrs:{clickable:""},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",[e._v(e._s(t.userId)+"/"+e._s(t.userName))])]},proxy:!0},{key:"right-icon",fn:function(){return[s("van-icon",{attrs:{name:"cross",size:"20px"},nativeOn:{click:function(s){return s.stopPropagation(),e.deletePerson(t)}}})]},proxy:!0}],null,!0)})})),1),s("div",{staticClass:"dropdown-opts"},[s("van-button",{staticClass:"dropdown-opts__btn",attrs:{type:"default",size:"small",block:"",round:""},on:{click:function(t){e.checkedShow=!1}}},[e._v("取消")]),s("van-button",{staticClass:"dropdown-opts__btn",attrs:{type:"info",size:"small",block:"",round:"",color:"#2271F5"},on:{click:function(t){e.checkedShow=!1}}},[e._v("确认")])],1)])],2)},i=[],c=s("2909"),r=s("d4ec"),n=s("bee2"),o=s("262e"),d=s("2caf"),l=(s("d81d"),s("d3b7"),s("caad"),s("2532"),s("a434"),s("b64b"),s("4de4"),s("6062"),s("3ca3"),s("ddb0"),s("99af"),s("9ab4")),h=s("1b40"),u=function(e){Object(o["a"])(s,e);var t=Object(d["a"])(s);function s(){var e;return Object(r["a"])(this,s),e=t.apply(this,arguments),e.keywords="",e.checkedShow=!1,e.checkedIdList=[],e.checkedId="",e.checkedName="",e.breadList=[],e.curDeptObj={},e.activeNames=["1"],e.allCheckedList=[],e}return Object(n["a"])(s,[{key:"userDataList",get:function(){var e,t=this.curDeptObj.depId||"";return(null===(e=this.deptUserData[t])||void 0===e?void 0:e.userList)||[]}},{key:"selectAll",get:function(){var e=this,t=this.userDataList.map((function(e){return e.userId})),s=!!t.length&&t.every((function(t){return e.checkedIdList.includes(t)}));return s}},{key:"onInput",value:function(){this.$emit("search",this.keywords)}},{key:"changeBread",value:function(e,t){this.breadList.splice(t+1),this.curDeptObj=e}},{key:"changeDept",value:function(e){var t=e.depId,s=e.depName,a=e.childList;this.breadList.push({depId:t,depName:s,childList:a}),this.curDeptObj=e,Object.keys(this.deptUserData).includes(String(e.depId))||this.$emit("refresh",e)}},{key:"onAllCheckClick",value:function(){var e=this.userDataList.map((function(e){return e.userId}));this.checkedIdList=this.selectAll?this.checkedIdList.filter((function(t){return!e.includes(t)})):Object(c["a"])(new Set([].concat(Object(c["a"])(this.checkedIdList),Object(c["a"])(e))))}},{key:"deletePerson",value:function(e){this.checkedIdList=this.checkedIdList.filter((function(t){return t!==e.userId}))}},{key:"onTreeConfirm",value:function(){if(this.isSelect)if(this.needName){var e=(this.allCheckedList.length>0?this.allCheckedList[0].userName:"")+(this.allCheckedList.length>1?","+this.allCheckedList[1].userName:"")+(this.allCheckedList.length>2?"等":"");this.$emit("confirm",{list:this.checkedIdList,name:e})}else this.$emit("confirm",this.checkedIdList);else{if(this.keywords){for(var t=0;t<this.searchList.length;t++)if(this.searchList[t].userId==this.checkedId){this.checkedName=this.searchList[t].userName;break}}else for(var s=0;s<this.userDataList.length;s++)if(this.userDataList[s].userId==this.checkedId){this.checkedName=this.userDataList[s].userName;break}this.$emit("confirm",this.checkedId,this.checkedName)}}},{key:"cancel",value:function(){this.$emit("cancel")}},{key:"mounted",value:function(){var e=this.depTreeList[0],t=e.depId,s=e.depName,a=e.childList;this.breadList=[{depId:t,depName:s,childList:a}],this.curDeptObj=this.depTreeList[0]}},{key:"onCheckedIdListChange",value:function(e){var t,s=this.depTreeList[0].depId,a=(null===(t=this.deptUserData[s])||void 0===t?void 0:t.userList)||[];this.allCheckedList=a.filter((function(t){return e.includes(t.userId)}))}}]),s}(h["d"]);Object(l["a"])([Object(h["c"])({type:Boolean,default:!0})],u.prototype,"isSelect",void 0),Object(l["a"])([Object(h["c"])({type:Boolean,default:!1})],u.prototype,"needName",void 0),Object(l["a"])([Object(h["c"])({type:Boolean,default:!1})],u.prototype,"show",void 0),Object(l["a"])([Object(h["c"])({type:Boolean,default:!1})],u.prototype,"loading",void 0),Object(l["a"])([Object(h["c"])({type:Array,default:[]})],u.prototype,"depTreeList",void 0),Object(l["a"])([Object(h["c"])({type:Object,default:{}})],u.prototype,"deptUserData",void 0),Object(l["a"])([Object(h["c"])({type:Array,default:[]})],u.prototype,"searchList",void 0),Object(l["a"])([Object(h["e"])("checkedIdList",{deep:!0,immediate:!0})],u.prototype,"onCheckedIdListChange",null),u=Object(l["a"])([Object(h["a"])({})],u);var p=u,f=p,k=(s("3da8"),s("2877")),v=Object(k["a"])(f,a,i,!1,null,"331fe828",null);t["a"]=v.exports},"3da8":function(e,t,s){"use strict";s("ddf6")},8393:function(e,t,s){"use strict";var a=s("1da1"),i=s("d4ec"),c=s("bee2"),r=s("262e"),n=s("2caf"),o=(s("96cf"),s("d3b7"),s("d81d"),s("9ab4")),d=s("1b40"),l=s("08de"),h=s("f727"),u=s("4bb5"),p=Object(u["a"])("crm"),f=function(e){Object(r["a"])(s,e);var t=Object(n["a"])(s);function s(){var e;return Object(i["a"])(this,s),e=t.apply(this,arguments),e.hasDept=!1,e.authorizedFlag=!0,e.leaderFlag=!1,e.userDataList=[],e.checkedUsers=[],e.changeTypeShow=!1,e.deptUserData={},e.checkDetailList=[],e.getUserListLoading=!1,e.needLoading=!0,e.timeout=null,e}return Object(c["a"])(s,[{key:"_getDepTree",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{treeType:1,authorizedFlag:this.authorizedFlag};return new Promise((function(s){e.actionGetDepTree(t).then((function(t){0===t.data.length?e.hasDept=!1:(e.changeTypeShow&&e._getUserByParams({depIdList:e.mapTreeList(e.depTreeList,[]),leaderFlag:e.leaderFlag,authorizedFlag:e.authorizedFlag}),e.hasDept=!0),s(t)}))}))}},{key:"_getUserByParams",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,s){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.getUserListLoading=!0,e.next=3,Object(h["h"])(t);case 3:return a=e.sent,"200"===a.code&&(this.getUserListLoading=!1,this.userDataList=a.data.map((function(e){var t=e.userId,s=e.userName,a=e.phoneNum,i=e.userMainDepNum,c=e.userMainDepName;return{userId:t,userName:s,phoneNum:a,userMainDepNum:i,userMainDepName:c}})),t.depIdList&&t.depIdList.length&&this.$set(this.deptUserData,s,{userList:this.userDataList,selectList:[]})),e.abrupt("return",new Promise((function(e){e(a)})));case 6:case"end":return e.stop()}}),e,this)})));function t(t,s){return e.apply(this,arguments)}return t}()},{key:"mapTreeList",value:function(e,t){for(var s=0;s<e.length;s++){var a=e[s];this.authorizedFlag?a.operationFlag&&t.push(a.depId):t.push(a.depId),a.childList&&a.childList.length>0&&this.mapTreeList(a.childList,t)}return t}},{key:"refreshUserByKeywords",value:function(e){var t=this;clearTimeout(this.timeout),this.timeout=setTimeout(Object(a["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:t._getUserByParams({keyword:e,leaderFlag:t.leaderFlag,authorizedFlag:t.authorizedFlag});case 1:case"end":return s.stop()}}),s)}))),800)}},{key:"refreshUserByDepts",value:function(e){this._getUserByParams({depIdList:this.mapTreeList([e],[]),leaderFlag:this.leaderFlag,authorizedFlag:this.authorizedFlag},e.depId)}},{key:"cancelUserByDepts",value:function(){this.$refs.deptUer.checkedIdList=this.checkedUsers,this.changeTypeShow=!1}},{key:"getUsersClick",value:function(){if(this.depTreeList&&this.depTreeList.length){this.changeTypeShow=!0;var e=this.$refs.deptUer;e.userDataList.length||this._getUserByParams({depIdList:this.mapTreeList(this.depTreeList,[]),leaderFlag:this.leaderFlag,authorizedFlag:this.authorizedFlag},this.depTreeList[0].depId)}}},{key:"destroyed",value:function(){this.authorizedFlag||(this.checkDetailList=[],this.SET_DEPTLIST([]))}},{key:"mounted",value:function(){this.needLoading&&(this.depTreeList&&this.depTreeList.length?this.hasDept=!0:this._getDepTree())}}]),s}(d["d"]);Object(o["a"])([p.Action],f.prototype,"actionGetDepTree",void 0),Object(o["a"])([p.Getter],f.prototype,"depTreeList",void 0),Object(o["a"])([p.Mutation],f.prototype,"SET_DEPTLIST",void 0),f=Object(o["a"])([Object(d["a"])({components:{DeptUser:l["a"]}})],f),t["a"]=f},ddf6:function(e,t,s){}}]);