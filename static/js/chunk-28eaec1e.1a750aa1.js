(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-28eaec1e"],{"4d98":function(t,s,i){"use strict";i("b189")},"5b10":function(t,s,i){"use strict";var e=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"full-width d-flex white-bg pa-3 mb-2 good-card"},[i("img",{staticClass:"good-img",attrs:{src:t.info.smallimglink}}),i("div",{staticClass:"font-12 ml-2 d-flex justify-space-between flex-column"},[i("div",{staticClass:"d-flex align-center"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isRouter,expression:"!isRouter"}],staticClass:"d-flex align-center justify-center stauts-div mr-1",class:"stauts-"+(t.info.nearlyEffectiveFlag?"1":"2")},[t._v(" "+t._s(t.info.nearlyEffectiveFlag?"近效期":t.info.waiteProcessFlag?"待处理":"")+" ")]),i("span",{staticClass:"font-13 fontWeight-500"},[t._v(t._s(t.info.goodsId)+"/"+t._s(t.info.goodsName))])]),i("span",{staticClass:"color-gray-7"},[t._v(t._s(t.info.goodstype)+"/"+t._s(t.info.goodsunit))]),i("div",{staticClass:"info-3"},[i("span",{directives:[{name:"show",rawName:"v-show",value:!t.isRouter,expression:"!isRouter"}],staticClass:"color-gray-7"},[t._v("待处理批号数:")]),i("span",{directives:[{name:"show",rawName:"v-show",value:!t.isRouter,expression:"!isRouter"}],staticClass:"ml-1"},[t._v(t._s(t.info.waiteProcessotNum?t.info.waiteProcessotNum:0))]),i("span",{directives:[{name:"show",rawName:"v-show",value:!t.isRouter,expression:"!isRouter"}],staticClass:"ml-4 color-gray-7"},[t._v("可销库存:")]),i("span",{directives:[{name:"show",rawName:"v-show",value:!t.isRouter,expression:"!isRouter"}],staticClass:"ml-1"},[t._v(t._s(t.info.nearlyEffectiveLotNum?t.info.nearlyEffectiveLotNum:0))])])])])},a=[],o=i("bee2"),n=i("d4ec"),l=i("262e"),c=i("2caf"),r=i("9ab4"),d=i("1b40"),u=function(t){Object(l["a"])(i,t);var s=Object(c["a"])(i);function i(){return Object(n["a"])(this,i),s.apply(this,arguments)}return Object(o["a"])(i)}(d["d"]);Object(r["a"])([Object(d["c"])({type:Object,default:{}})],u.prototype,"info",void 0),Object(r["a"])([Object(d["c"])({type:Boolean,default:!1})],u.prototype,"isRouter",void 0),u=Object(r["a"])([Object(d["a"])({components:{}})],u);var g=u,v=g,p=(i("4d98"),i("2877")),f=Object(p["a"])(v,e,a,!1,null,"7b01fe0c",null);s["a"]=f.exports},a3e7:function(t,s,i){"use strict";i("e93a")},b189:function(t,s,i){},e93a:function(t,s,i){},ef84:function(t,s,i){"use strict";i.r(s);var e=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"full-HW goods-detail"},[i("good-card",{attrs:{info:t.info,isRouter:t.isRouter},nativeOn:{click:function(s){return t.showDetail(t.item)}}}),i("div",{staticClass:"detail-content"},t._l(t.goodsDtlList,(function(s,e){return i("div",{key:e,staticClass:"box-shadow white-bg detail-card mb-2",on:{click:function(s){return t.showMore(e)}}},[i("van-swipe-cell",{scopedSlots:t._u([{key:"right",fn:function(){return[i("van-button",{staticClass:"full-height swipe-button",attrs:{square:"",text:1==t.tabActiveIndex?"查看所有":"批量处理",type:"info"},on:{click:function(s){return s.stopPropagation(),t.uploadAll(e)}}})]},proxy:!0}],null,!0)},[i("div",{staticClass:"detail-card-top"},[i("div",{staticClass:"d-flex align-center mb-2"},[i("div",{staticClass:"goods-status"},[t._v(t._s(s.goodsStatus))]),i("span",{staticClass:"color-gray-4",staticStyle:{"margin-left":"auto"}},[t._v("批号：")]),i("span",{staticClass:"font-14 fontWeight-500"},[t._v(t._s(s.lotno))]),i("van-icon",{staticClass:"ml-2 font-14 fontWeight-500 detail-arrow",class:t.chooseIndex==e?"active":"",attrs:{name:"arrow-down"}})],1),i("div",{staticClass:"d-flex align-center justify-space-between line-text"},[i("span",{staticClass:"color-gray-4"},[t._v("可销库存")]),i("span",[t._v(t._s(s.mindtlgoodsqty))])]),i("div",{staticClass:"d-flex align-center justify-space-between line-text"},[i("span",{staticClass:"color-gray-4"},[t._v("二销库存")]),i("span",[t._v(t._s(s.dtlsecgoodsqty))])]),i("div",{staticClass:"d-flex align-center justify-space-between line-text"},[i("span",{staticClass:"color-gray-4"},[t._v("保管账")]),i("span",[t._v(t._s(s.storageName))])]),i("div",{staticClass:"d-flex align-center justify-space-between line-text",staticStyle:{"margin-bottom":"0"}},[i("span",{staticClass:"color-gray-4"},[t._v("效期")]),i("span",[t._v(" "+t._s(s.invalidDate.substring(0,10))+" "),i("span",{staticClass:"color-main-2"},[t._v("("+t._s(s.diffDay)+"天)")])])])])]),i("div",{staticClass:"detail-card-bottom",class:t.chooseIndex===e?"active":""},[i("div",{staticClass:"more-block van-popup-bg"}),t._l(s.pqcsImgRecordList,(function(s,e){return i("div",{key:e,staticClass:"d-flex align-center justify-space-between task-div"},[i("div",[i("div",{staticClass:"d-flex align-center line-text"},[i("div",{staticClass:"text-head-1 color-gray-4"},[t._v("创建时间")]),i("div",[t._v(t._s(s.createTime))])]),i("div",{staticClass:"d-flex align-center line-text"},[i("div",{staticClass:"text-head-1 color-gray-4"},[t._v("创建人")]),i("div",[t._v(t._s(s.sponsorId)+"/"+t._s(s.sponsorName))])])]),i("van-button",{staticClass:"upload-button font-12",attrs:{plain:"",round:"",type:"info"},on:{click:function(i){return i.stopPropagation(),t.handleClick(s)}}},[t._v(" "+t._s(1==t.tabActiveIndex?"查看":"上传")+"照片 ")])],1)}))],2)],1)})),0),i("van-popup",{staticClass:"popup-body",attrs:{round:"",closeable:"",position:"bottom"},model:{value:t.showPopup,callback:function(s){t.showPopup=s},expression:"showPopup"}},[i("div",{staticClass:"popup-title font-16 fontWeight-500"},[t._v(" "+t._s(t.isAll?"批量处理":1==t.tabActiveIndex?"查看照片":"上传照片")+" ")]),i("div",{staticClass:"popup-info"},[i("div",{staticClass:"d-flex align-center mb-2"},[i("div",{staticClass:"goods-status"},[t._v(t._s(t.nowGoods.goodsStatus))]),i("span",{staticClass:"font-13 fontWeight-500 ml-2"},[t._v(t._s(t.nowGoods.goodsId)+"/"+t._s(t.nowGoods.goodsName))])]),i("div",{staticClass:"d-flex align-center mb-2"},[i("span",{staticClass:"color-gray-4"},[t._v("批号：")]),i("span",{staticClass:"font-14 fontWeight-500"},[t._v(t._s(t.nowGoods.lotno))])]),i("div",{staticClass:"d-flex align-center mb-2"},[i("span",{staticClass:"color-gray-4"},[t._v("规格：")]),i("span",[t._v(t._s(t.nowGoods.goodstype))])]),i("div",{staticClass:"d-flex align-center mb-2"},[i("span",{staticClass:"color-gray-4"},[t._v("厂家：")]),i("span",[t._v(t._s(t.nowGoods.factoryname))])]),t.nowTask?i("div",{staticClass:"d-flex align-center mb-2"},[i("span",{staticClass:"color-gray-4"},[t._v("创建时间：")]),i("span",[t._v(t._s(t.nowTask.createTime))])]):t._e(),t.nowTask?i("div",{staticClass:"d-flex align-center"},[i("span",{staticClass:"color-gray-4"},[t._v("发起人：")]),i("span",[t._v(t._s(t.nowTask.sponsorId)+"/"+t._s(t.nowTask.sponsorName))])]):t._e()]),t.isAll&&!t.tabActiveIndex?i("div",{staticClass:"all-info color-red mt-2"},[t._v("批量处理所有发起")]):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.tabActiveIndex,expression:"!tabActiveIndex"}],staticClass:"upload-div mx-4 mt-2",class:t.isAll?"active":""},[i("van-uploader",{attrs:{multiple:""},model:{value:t.fileList,callback:function(s){t.fileList=s},expression:"fileList"}})],1),i("van-list",{directives:[{name:"show",rawName:"v-show",value:t.tabActiveIndex,expression:"tabActiveIndex"}],staticClass:"upload-div mx-4 mt-2 img-content",attrs:{finished:t.finished},on:{load:function(s){return t._getimgsPqsc(t.info)}},model:{value:t.imgLoading,callback:function(s){t.imgLoading=s},expression:"imgLoading"}},t._l(t.imgList,(function(s,e){return i("van-image",{key:"img-2-"+e,attrs:{fit:"contain",src:s},on:{click:function(s){return t.showBigImg(e)}}})})),1),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.tabActiveIndex,expression:"!tabActiveIndex"}],staticClass:"popup-button-div ma-4"},[i("van-button",{staticClass:"popup-button mr-3",attrs:{round:"",plain:""},on:{click:function(s){t.showPopup=!1}}},[t._v("取消")]),i("van-button",{staticClass:"popup-button",attrs:{round:"",type:"info"},on:{click:t.admitPhoto}},[t._v("提交")])],1)],1)],1)},a=[],o=(i("4662"),i("28a2")),n=i("d4ec"),l=i("bee2"),c=i("262e"),r=i("2caf"),d=(i("d3b7"),i("159b"),i("99af"),i("ac1f"),i("1276"),i("b0c0"),i("9ab4")),u=i("1b40"),g=i("5b10"),v=i("a403"),p=function(t){Object(c["a"])(i,t);var s=Object(r["a"])(i);function i(){var t;return Object(n["a"])(this,i),t=s.apply(this,arguments),t.info={},t.tabActiveIndex=0,t.fileList=[],t.goodsDtlList=[],t.chooseIndex=-1,t.showPopup=!1,t.isAll=!1,t.nowGoods={},t.nowTask={},t.imgList=[],t.imgTotal=0,t.page=1,t.imgLoading=!1,t.finished=!1,t.isRouter=!1,t.activeNames=[0],t}return Object(l["a"])(i,[{key:"init",value:function(t){var s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.showPopup=!1,this.isRouter=s,s?(this.info=t,this._getimgsPqsc(this.info)):(this.info=t.item,this.tabActiveIndex=t.index,this._getGoodsDtlPcsq(this.info))}},{key:"_getGoodsDtlPcsq",value:function(t){var s=this;this.fileList=[];var i={};i=this.isRouter?{entryId:this.$route.query.entryId,goodsId:this.$route.query.goodsId,storageId:this.$route.query.storageId,lotid:this.$route.query.lotid,cpsiId:this.$route.query.cpsiId,pqcsFlag:this.tabActiveIndex}:{entryId:t.entryId,goodsId:t.goodsId,storageId:t.storageId,pqcsFlag:this.tabActiveIndex},Object(v["g"])(i).then((function(t){s.goodsDtlList=t,s.isRouter&&(s.info=s.goodsDtlList[0]),0!==s.goodsDtlList.length||s.$toast.fail("无细单列表")}))}},{key:"showMore",value:function(t){this.chooseIndex!==t?this.chooseIndex=t:this.chooseIndex=-1}},{key:"handleClick",value:function(t){this.isAll=!1,this.nowGoods=this.goodsDtlList[this.chooseIndex],this.nowTask=t,this.showPopup=!0,this.imgList=[],1==this.tabActiveIndex&&(this.page=1,this.finished=!1,this._getimgsPqsc(this.info))}},{key:"uploadAll",value:function(t){this.isAll=!0,this.nowGoods=this.goodsDtlList[t],this.nowTask=null,this.showPopup=!0,this.imgList=[],1==this.tabActiveIndex&&(this.page=1,this.finished=!1,this._getimgsPqsc(this.info))}},{key:"_getimgsPqsc",value:function(t){var s=this,i={};this.isRouter?(i={shareEntryId:this.$route.query.entryId,goodsId:this.$route.query.goodsId,goodsStatusId:this.$route.query.goodsStatusId,lotid:this.$route.query.lotid,storageId:this.$route.query.storageId,pageNum:1,pageSize:1,cpsiId:this.$route.query.cpsiId},this.finished=!0):(this.imgLoading=!0,i={entryId:t.entryId,goodsId:t.goodsId,goodsStatusId:t.goodsStatusId,lotid:t.lotid,pqcsFlag:1,cpsiId:this.nowTask?this.nowTask.cpsiId:"",storageId:t.storageId,pageNum:this.page,pageSize:100}),Object(v["p"])(i).then((function(t){s.isRouter?t.list&&t.list.length>0&&(s.tabActiveIndex=t.list[0].pqcsFlag,s.imgList=t.list[0].imgList,s._getGoodsDtlPcsq(s.info)):(s.imgLoading=!1,t.list.length>0&&t.list.forEach((function(t){s.imgList=s.imgList.concat(t.imgList?t.imgList:[])})),s.imgTotal=t.total,100*s.page>=s.imgTotal&&(s.finished=!0))}))}},{key:"admitPhoto",value:function(){var t=this,s=[];if(this.nowTask&&this.nowTask.cpsiId)s.push(this.nowTask.cpsiId);else for(var i=0;i<this.nowGoods.pqcsImgRecordList.length;i++){var e=this.nowGoods.pqcsImgRecordList[i];s.push(e.cpsiId)}var a=new FormData;if(0!==this.fileList.length){for(var o=0;o<this.fileList.length;o++){var n=this.fileList[o];n.status="uploading",n.message="上传中...";var l=n.file.name.split("."),c=new File([n.file],"index"+o+"."+l[l.length-1]);a.append("imgs",c)}a.append("cpsiIds",s),Object(v["w"])(a).then((function(s){if(sessionStorage.setItem("wmsChange","1"),"200"===s.code){for(var i=0;i<t.fileList.length;i++){var e=t.fileList[i];e.status="success",e.message="上传成功"}t.$toast.success("上传成功"),t.showPopup=!1,setTimeout((function(){1!=t.goodsDtlList.length||t.nowTask&&t.nowTask.cpsiId&&1!=t.goodsDtlList[0].pqcsImgRecordList.length||(t.tabActiveIndex=1),t._getGoodsDtlPcsq(t.info)}),800)}else for(var a=0;a<t.fileList.length;a++){var o=t.fileList[a];o.status="failed",o.message="上传失败"}}))}else this.$toast.fail("请选择要上传的图片")}},{key:"showBigImg",value:function(t){Object(o["a"])({images:this.imgList,startPosition:t})}},{key:"mounted",value:function(){this.$route.query&&this.$route.query.entryId?this.init(this.$route.query,!0):this.$route.params&&this.$route.params.isSj&&this.init(this.$route.params,!1)}}]),i}(u["d"]);p=Object(d["a"])([Object(u["a"])({components:{goodCard:g["a"]}})],p);var f=p,h=f,m=(i("a3e7"),i("2877")),b=Object(m["a"])(h,e,a,!1,null,"b49b9d6a",null);s["default"]=b.exports}}]);