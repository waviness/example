(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-230f910c"],{6380:function(t,e,a){},a409:function(t,e,a){"use strict";a("6380")},fc81:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pb-100"},[a("project-ex-common-block",{attrs:{leaderLevel:t.leaderLevel,data:t.data,selectMonth:t.selectMonth,columns:t.columns,orgList:t.orgList,resList:t.resList},on:{tabChange:t.onTabChange,monthChange:t.onMonthChange,search:t.onDeptSearch,userChange:t.onUserChange}},[a("div",{staticClass:"d-flex align-center"},[a("van-search",{staticClass:"flex-1",attrs:{clearable:"",placeholder:t.placeholder},on:{search:t.onSearch},model:{value:t.searchParams.key,callback:function(e){t.$set(t.searchParams,"key",e)},expression:"searchParams.key"}}),a("type-tab",{attrs:{type:t.typeValue},on:{click:t.onTypeChange}})],1),a("div",{staticClass:"overflow-x-auto"},[a("div",{staticClass:"d-flex",staticStyle:{"min-width":"511px",height:"44px"}},[a("th-item",{staticClass:"ex-item-left",staticStyle:{width:"16%","min-width":"75px"},attrs:{title:"项目名称"}}),a("th-item",{staticClass:"ml-2",staticStyle:{width:"16%","min-width":"78px"},attrs:{title:"指标口径"}}),a("th-item",{staticClass:"ml-2",staticStyle:{width:"16%","min-width":"78px"},attrs:{title:"口径类型"}}),a("th-item",{staticClass:"ml-2",staticStyle:{width:"15%","min-width":"60px"},attrs:{title:1===t.typeValue?"指标":"覆盖"}}),a("th-item",{staticClass:"ml-2",staticStyle:{width:"20%","min-width":"102px"},attrs:{title:1===t.typeValue?"完成指标":"已覆盖",sort:t.searchParams.finishnum,sortShow:""},on:{click:function(e){return t.onSortClick(1)}}}),a("th-item",{staticClass:"ml-2",staticStyle:{width:"17%","min-width":"78px"},attrs:{title:1===t.typeValue?"完成率":"覆盖率",sort:t.searchParams.ratenum,sortShow:""},on:{click:function(e){return t.onSortClick(2)}}})],1),a("van-list",{staticStyle:{"min-width":"527px"},attrs:{finished:t.finished,"finished-text":"",error:t.error,"error-text":"请求失败，点击重新加载","immediate-check":!1},on:{"update:error":function(e){t.error=e},load:t.getDataList},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},[a("app-empty",{directives:[{name:"show",rawName:"v-show",value:!t.loading&&!t.list.length,expression:"!loading && !list.length"}],staticClass:"py-7",attrs:{description:"暂无数据"}}),t._l(t.list,(function(e,i){return a("project-ex-item",{key:i,attrs:{data:e,gray:i%2===0},on:{click:function(a){return t.toProject(e)}}})}))],2)],1)]),a("fix-button",{attrs:{title:"点击查看排名",smallFont:""},on:{click:t.toRank}})],1)},n=[],r=a("2909"),s=a("1da1"),c=a("d4ec"),o=a("bee2"),h=a("262e"),l=a("2caf"),d=(a("96cf"),a("d3b7"),a("159b"),a("ac1f"),a("1276"),a("caad"),a("2532"),a("a9e3"),a("99af"),a("5319"),a("b0c0"),a("7db0"),a("25f0"),a("9ab4")),u=a("1b40"),p=a("e124"),m=a("a8c3"),f=a("4bb5"),g=Object(f["a"])("app"),v=function(t){Object(h["a"])(a,t);var e=Object(l["a"])(a);function a(){var t;return Object(c["a"])(this,a),t=e.apply(this,arguments),t.leaderLevel=0,t.typeValue=1,t.data={},t.searchParams={key:"",finishnum:1,ratenum:0},t.page=1,t.pageSize=10,t.list=[],t.loading=!1,t.refreshing=!1,t.finished=!1,t.error=!1,t}return Object(o["a"])(a,[{key:"getSelectList",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a,i,n,s,c,o,h,l,d,u,p,f,g,v,y,b,L,k,x=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(m["r"])({flag:2});case 2:return e=t.sent,this.columns=[],e.data.forEach((function(t){var e=t.split("-"),a=0;x.columns.forEach((function(t){t.text==="".concat(e[0],"年")&&(t.children.includes("".concat(Number(e[1]),"月"))||t.children.push({text:"".concat(Number(e[1]),"月")}),a=1)})),a||x.columns.push({text:"".concat(e[0],"年"),children:[{text:"".concat(Number(e[1]),"月")}]})})),a=e.data[e.data.length-1],this.selectMonth=a?"".concat(a.split("-")[0],".").concat(a.split("-")[1]):"",t.next=9,Object(m["v"])({date:this.selectMonth.replace(".","-")});case 9:i=t.sent,n=JSON.parse(localStorage.getItem("permissions")||""),s=n.some((function(t){return"projectManage-queryAll"===t})),s&&(i.data.leaderLevel=1),c=i.data.deptTreeList[0],this.orgOriginList=[],c.deptVO.forEach((function(t){var e=[{id:"".concat(t.deptId,"-1"),name:"不限",parentId:t.deptId}];t.deptVO.forEach((function(a){var i=a.deptId,n=a.deptName;e.push({id:i,name:n,parentId:t.deptId})})),x.orgOriginList.push({id:t.deptId,name:t.deptName,children:e})})),this.orgOriginList.unshift({id:c.parentId,name:c.parentName,children:[{id:"".concat(c.parentId,"-1"),name:"不限",parentId:c.parentId}]}),this.orgList=Object(r["a"])(this.orgOriginList),1===i.data.leaderLevel?(o=this.orgList[0],h=o.id,l=o.name,d=o.children,this.resList=[{id:h,name:l,children:d},{id:"".concat(h,"-1"),name:"不限"}]):2===i.data.leaderLevel?(u=this.orgList.find((function(t){return t.id===i.data.crmGroup.depId})),p=u.id,f=u.name,g=u.children,this.resList=[{id:p,name:f,children:g},{id:"".concat(p,"-1"),name:"不限"}]):(v=this.orgList.find((function(t){var e=t.id;return e===i.data.crmGroup.parentId})),y=v.children.find((function(t){var e=t.id;return e===i.data.crmGroup.depId})),b=v.id,L=v.name,k=v.children,this.resList=[{id:b,name:L,children:k},{id:(null===y||void 0===y?void 0:y.id)||"".concat(b,"-1"),name:(null===y||void 0===y?void 0:y.name)||"不限"}]),this.getData(),this.onSearch();case 21:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"onMonthChange",value:function(t){this.selectMonth=t,this.getData(),this.onSearch()}},{key:"onUserChange",value:function(t){this.onDeptSearch(""),this.resList=Object(r["a"])(t),this.getData(),this.onSearch()}},{key:"onTabChange",value:function(){this.$crmUserClick({catalogType:504,catalogTypeName:"项目管理",cucrId:"",menuId:"1",menuName:"准入管理",menuOperation:"项目管理中准入管理Tab",operationType:2}),this.$router.replace({path:"projectManage"})}},{key:"getData",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(m["k"])({date:this.selectMonth.replace(".","-"),centerId:1===this.resList[0].id?"":this.resList[0].id,crmDeptId:this.resList[1].id.toString().includes("-1")?"":this.resList[1].id});case 2:e=t.sent,this.data=e.data;case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"onSortClick",value:function(t){1===t&&(this.searchParams.finishnum=1===this.searchParams.finishnum?2:1,this.searchParams.ratenum=0),2===t&&(this.searchParams.ratenum=1===this.searchParams.ratenum?2:1,this.searchParams.finishnum=0),this.onSearch()}},{key:"onTypeChange",value:function(t){this.typeValue=t,this.onSearch()}},{key:"onSearch",value:function(){this.finished=!1,this.list=[],this.page=1,this.getDataList()}},{key:"getDataList",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a,i,n,s,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.searchParams,a=e.key,i=e.finishnum,n=e.ratenum,s={date:this.selectMonth.replace(".","-"),centerId:1===this.resList[0].id?"":this.resList[0].id,crmDeptId:this.resList[1].id.toString().includes("-1")?"":this.resList[1].id,flag:this.typeValue,key:a,orderColumn:i?"targetCompleted":n?"completeRate":"",orderType:2===i||2===n?1:0,pageNum:this.page,pageSize:this.pageSize},this.loading=!0,t.next=5,Object(m["i"])(s);case 5:c=t.sent,this.loading=!1,this.refreshing=!1,c.success?(c.data.list.forEach((function(t){t.name=t.projectName})),this.list=[].concat(Object(r["a"])(this.list),Object(r["a"])(c.data.list)),this.page++,this.finished=!c.data.hasNextPage):this.error=!0;case 9:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"toProject",value:function(t){this.SET_PROJECTPARAMS({data:t,selectMonth:this.selectMonth,columns:this.columns,orgOriginList:this.orgOriginList,resList:this.resList,typeValue:this.typeValue}),this.SET_HADDONEONDETAIL(!0),this.$router.push({name:"ProjectManageExGoods"})}},{key:"toRank",value:function(){this.$router.push({name:"ProjectManageExRank",query:{date:this.selectMonth.replace(".","-")}})}},{key:"created",value:function(){this.leaderLevel=this.queryParams.leaderLevel,this.getSelectList()}}]),a}(Object(u["b"])(p["a"]));Object(d["a"])([g.Getter],v.prototype,"queryParams",void 0),Object(d["a"])([g.Mutation],v.prototype,"SET_PROJECTPARAMS",void 0),Object(d["a"])([g.Mutation],v.prototype,"SET_HADDONEONDETAIL",void 0),v=Object(d["a"])([Object(u["a"])({beforeRouteEnter:function(t,e,a){"ProjectManageExGoods"===e.name&&e.params.flag&&a({name:"ProjectManage",replace:!0}),a((function(t){"ProjectManage"!==e.name&&"ProjectManageGoods"!==e.name||t.$nextTick((function(){t.getSelectList()}))}))}})],v);var y=v,b=y,L=(a("a409"),a("2877")),k=Object(L["a"])(b,i,n,!1,null,"63b1574e",null);e["default"]=k.exports}}]);