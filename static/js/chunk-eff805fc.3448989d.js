(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-eff805fc"],{"1ad2":function(e,t,a){"use strict";a("ea32")},"1fcf":function(e,t,a){},"498c":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"pb-100"},[a("project-common-block",{attrs:{leaderLevel:e.leaderLevel,data:e.data,selectMonth:e.selectMonth,columns:e.columns,orgList:e.orgList,resList:e.resList},on:{tabChange:e.onTabChange,monthChange:e.onMonthChange,search:e.onUserSearch,userChange:e.onUserChange}},[a("van-search",{attrs:{clearable:"",placeholder:e.placeholder},on:{search:e.onSearch},model:{value:e.searchParams.key,callback:function(t){e.$set(e.searchParams,"key",t)},expression:"searchParams.key"}}),a("div",{staticClass:"d-flex ml-4 py-3"},[a("th-item",{staticClass:"flex-1",attrs:{title:"项目名称"}}),a("th-item",{staticClass:"flex-1 ml-2",attrs:{title:"产品数量",sort:e.searchParams.goodsnum,sortShow:""},on:{click:function(t){return e.onSortClick(1)}}}),a("th-item",{staticClass:"flex-1 ml-2",attrs:{title:"目标条目",sort:e.searchParams.targetnum,sortShow:""},on:{click:function(t){return e.onSortClick(2)}}}),a("th-item",{staticClass:"flex-1 ml-2",attrs:{title:"准入条目",sort:e.searchParams.allownum,sortShow:""},on:{click:function(t){return e.onSortClick(3)}}})],1),a("van-pull-refresh",{on:{refresh:e.onSearch},model:{value:e.refreshing,callback:function(t){e.refreshing=t},expression:"refreshing"}},[a("van-list",{attrs:{finished:e.finished,"finished-text":"",error:e.error,"error-text":"请求失败，点击重新加载","immediate-check":!1},on:{"update:error":function(t){e.error=t},load:e.getDataList},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},[a("app-empty",{directives:[{name:"show",rawName:"v-show",value:!e.loading&&!e.list.length,expression:"!loading && !list.length"}],staticClass:"py-7",attrs:{description:"暂无数据"}}),e._l(e.list,(function(t,r){return a("project-item",{key:r,attrs:{data:t,gray:r%2===0},on:{click:function(a){return e.toProject(t)}}})}))],2)],1)],1),e.leaderLevel?a("fix-button",{attrs:{title:"点击查看排名",smallFont:""},on:{click:e.toRank}}):e._e()],1)},s=[],n=a("2909"),i=a("1da1"),c=a("d4ec"),o=a("bee2"),l=a("262e"),u=a("2caf"),d=(a("96cf"),a("d3b7"),a("ac1f"),a("5319"),a("159b"),a("1276"),a("caad"),a("2532"),a("a9e3"),a("99af"),a("b0c0"),a("7db0"),a("d81d"),a("4de4"),a("25f0"),a("9ab4")),h=a("1b40"),m=a("5238"),p=a("a8c3"),f=a("4bb5"),g=Object(f["a"])("app"),v=function(e){Object(l["a"])(a,e);var t=Object(u["a"])(a);function a(){var e;return Object(c["a"])(this,a),e=t.apply(this,arguments),e.leaderLevel=0,e.data={},e.searchParams={key:"",goodsnum:1,targetnum:0,allownum:0},e.page=1,e.pageSize=10,e.list=[],e.loading=!1,e.refreshing=!1,e.finished=!1,e.error=!1,e}return Object(o["a"])(a,[{key:"getSelectList",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,r,s,i,c,o,l,u,d,h,m,f,g,v,b,L,j,O,y,k,C,x=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.next=3,Object(p["p"])({});case 3:return t=e.sent,a=JSON.parse(localStorage.getItem("permissions")||""),r=a.some((function(e){return"projectManage-queryAll"===e})),r&&(t.data=1),this.leaderLevel=t.data,this.SET_QUERYPARAMA({leaderLevel:this.leaderLevel}),t.data&&1!==t.data&&this.$router.replace("ProjectManageEx"),e.next=14,Object(p["r"])({flag:1});case 14:if(s=e.sent,this.columns=[],s.data.forEach((function(e){var t=e.split("-"),a=0;x.columns.forEach((function(e){e.text==="".concat(t[0],"年")&&(e.children.includes("".concat(Number(t[1]),"月"))||e.children.push({text:"".concat(Number(t[1]),"月")}),a=1)})),a||x.columns.push({text:"".concat(t[0],"年"),children:[{text:"".concat(Number(t[1]),"月")}]})})),i=s.data[s.data.length-1],this.selectMonth=i?"".concat(i.split("-")[0],".").concat(i.split("-")[1]):"",!this.leaderLevel){e.next=33;break}return e.next=22,Object(p["v"])({date:this.selectMonth.replace(".","-")});case 22:c=e.sent,o=JSON.parse(localStorage.getItem("permissions")||""),l=o.some((function(e){return"projectManage-queryAll"===e})),l&&(c.data.leaderLevel=1),this.leaderLevel=t.data,u=c.data.deptTreeList[0],this.orgOriginList=[],u.deptVO.forEach((function(e){var t=[{id:"".concat(e.deptId,"-1"),name:"不限",parentId:e.deptId,crmUserDtoList:e.crmUserDtoList}];e.deptVO.forEach((function(a){var r=a.deptId,s=a.deptName,n=a.crmUserDtoList;t.push({id:r,name:s,parentId:e.deptId,crmUserDtoList:n})})),x.orgOriginList.push({id:e.deptId,name:e.deptName,children:t})})),this.orgOriginList.unshift({id:u.parentId,name:u.parentName,children:[{id:"".concat(u.parentId,"-1"),name:"不限",parentId:u.parentId,crmUserDtoList:u.crmUserDtoList}]}),this.orgList=Object(n["a"])(this.orgOriginList),1===c.data.leaderLevel?(d=this.orgList[0],h=d.id,m=d.name,f=d.children,this.resList=[{id:h,name:m,children:f},{id:"".concat(h,"-1"),name:"不限",crmUserDtoList:f[0].crmUserDtoList},[{userId:-1,userName:"不限"}]]):2===c.data.leaderLevel?(g=this.orgList.find((function(e){return e.id===c.data.crmGroup.depId})),v=g.id,b=g.name,L=g.children,this.resList=[{id:v,name:b,children:L},{id:"".concat(v,"-1"),name:"不限",crmUserDtoList:L[0].crmUserDtoList},[{userId:-1,userName:"不限"}]]):(j=this.orgList.find((function(e){var t=e.id;return t===c.data.crmGroup.parentId})),O=j.children.find((function(e){var t=e.id;return t===c.data.crmGroup.depId})),y=j.id,k=j.name,C=j.children,this.resList=[{id:y,name:k,children:C},{id:(null===O||void 0===O?void 0:O.id)||"".concat(y,"-1"),name:(null===O||void 0===O?void 0:O.name)||"不限",crmUserDtoList:(null===O||void 0===O?void 0:O.crmUserDtoList)||[]},[{userId:-1,userName:"不限"}]]);case 33:this.getData(),this.onSearch();case 35:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"onTabChange",value:function(){this.$crmUserClick({catalogType:504,catalogTypeName:"项目管理",cucrId:"",menuId:"2",menuName:"深分进度",menuOperation:"项目管理中深度分析Tab",operationType:2}),this.$router.replace({name:"ProjectManageEx"})}},{key:"getData",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={date:this.selectMonth.replace(".","-"),userIdList:this.leaderLevel?this.resList[2].filter((function(e){var t=e.userId;return-1!==t})).map((function(e){var t=e.userId;return t})):[this.userInfor.userId]},this.leaderLevel&&(t.centerId=1===this.resList[0].id?"":this.resList[0].id,t.crmDeptId=this.resList[1].id.toString().includes("-1")?"":this.resList[1].id),e.next=4,Object(p["c"])(t);case 4:a=e.sent,this.data=a.data;case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"onMonthChange",value:function(e){this.selectMonth=e,this.getData(),this.onSearch()}},{key:"onUserChange",value:function(e){this.onUserSearch(""),this.resList=Object(n["a"])(e),this.getData(),this.onSearch()}},{key:"onSortClick",value:function(e){1===e&&(this.searchParams.goodsnum=1===this.searchParams.goodsnum?2:1,this.searchParams.targetnum=0,this.searchParams.allownum=0),2===e&&(this.searchParams.targetnum=1===this.searchParams.targetnum?2:1,this.searchParams.goodsnum=0,this.searchParams.allownum=0),3===e&&(this.searchParams.allownum=1===this.searchParams.allownum?2:1,this.searchParams.goodsnum=0,this.searchParams.targetnum=0),this.onSearch()}},{key:"onSearch",value:function(){this.finished=!1,this.list=[],this.page=1,this.getDataList()}},{key:"getDataList",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,r,s,i,c,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.searchParams,a=t.key,r=t.goodsnum,s=t.targetnum,i=t.allownum,c={date:this.selectMonth.replace(".","-"),userIdList:this.leaderLevel?this.resList[2].filter((function(e){var t=e.userId;return-1!==t})).map((function(e){var t=e.userId;return t})):[this.userInfor.userId],key:a,orderColumn:r?"productNum":s?"goalNum":i?"accessNum":"",orderType:2===r||2===s||2===i?1:0,pageNum:this.page,pageSize:this.pageSize},this.leaderLevel&&(c.centerId=1===this.resList[0].id?"":this.resList[0].id,c.crmDeptId=this.resList[1].id.toString().includes("-1")?"":this.resList[1].id),this.loading=!0,this.refreshing=!1,e.next=7,Object(p["b"])(c);case 7:o=e.sent,this.loading=!1,o.success?(this.list=[].concat(Object(n["a"])(this.list),Object(n["a"])(o.data.list)),this.page++,this.finished=!o.data.hasNextPage):this.error=!0;case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"toProject",value:function(e){this.SET_PROJECTPARAMS({data:e,selectMonth:this.selectMonth,columns:this.columns,orgOriginList:this.orgOriginList,resList:this.resList,leaderLevel:this.leaderLevel}),this.$router.push({name:"ProjectManageGoods"})}},{key:"toRank",value:function(){this.$router.push({name:"ProjectManageRank",query:{date:this.selectMonth.replace(".","-")}})}},{key:"created",value:function(){this.getSelectList()}}]),a}(Object(h["b"])(m["a"]));Object(d["a"])([g.Getter],v.prototype,"userInfor",void 0),Object(d["a"])([g.Mutation],v.prototype,"SET_PROJECTPARAMS",void 0),Object(d["a"])([g.Mutation],v.prototype,"SET_QUERYPARAMA",void 0),v=Object(d["a"])([Object(h["a"])({beforeRouteEnter:function(e,t,a){"ProjectManageGoods"===t.name&&t.params.flag&&a({name:"ProjectManageEx",replace:!0}),"Home"===t.name&&a((function(e){e.$crmUserClick({catalogType:504,catalogTypeName:"项目管理",cucrId:"",menuId:"",menuName:"",menuOperation:"点击项目管理模块进入",operationType:2})})),a((function(e){"ProjectManageEx"!==t.name&&"ProjectManageExGoods"!==t.name||e.$nextTick((function(){e.getSelectList()}))}))}})],v);var b=v,L=b,j=(a("4ee8"),a("2877")),O=Object(j["a"])(L,r,s,!1,null,"0d490ce4",null);t["default"]=O.exports},"4cbb":function(e,t,a){"use strict";a("1fcf")},"4ee8":function(e,t,a){"use strict";a("982a")},5238:function(e,t,a){"use strict";var r=a("2909"),s=a("d4ec"),n=a("bee2"),i=a("262e"),c=a("2caf"),o=(a("d3b7"),a("159b"),a("caad"),a("2532"),a("b0c0"),a("9ab4")),l=a("1b40"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("van-sticky",[a("block-tab",{attrs:{active:0,list:e.leaderLevel?1===e.leaderLevel?["准入管理","深分进度"]:["深分进度"]:["准入管理"]},on:{change:e.onTabChange}})],1),a("div",{staticClass:"pa-10"},[e.leaderLevel?a("div",{staticClass:"d-flex font-14"},[a("div",{staticClass:"background-color-main-3 border-radius-10 color-white fontWeight py-3 px-4",on:{click:function(t){e.showSelectMonth=!0}}},[e._v(" "+e._s(e.selectMonth)+" ")]),a("div",{staticClass:"flex-1 ml-2 background-color-white border-radius-10 color-black-2 fontWeight pa-10 d-flex align-center slh",on:{click:function(t){e.showSelect=!0}}},[a("div",{staticClass:"flex-1 slh"},[e._v(" "+e._s(e.resList.length?e.resList[0].name:"")+"/"+e._s(e.resList[1]?e.resList[1].name:"")+e._s(e.resList[1]&&-1===e.resList[1].id?"部门":"")+"/"+e._s(e.resList[2]&&e.resList[2].map((function(e){return e.userName})).join("、"))+e._s(e.resList[2]&&-1===e.resList[2][0].userId?"业务员":"")+" ")]),a("van-icon",{staticClass:"ml-1 font-14 color-gray-4",attrs:{name:e.showSelect?"arrow-up":"arrow-down"}})],1)]):a("div",{staticClass:"d-flex justify-space-between align-center pa-10 font-14 fontWeight background-color-white border-radius-10",on:{click:function(t){e.showSelectMonth=!0}}},[a("div",{staticClass:"color-black-2"},[e._v(e._s(e.selectMonth))]),a("div",{staticClass:"color-gray-3"},[e._v("月份筛选")])]),a("div",{staticClass:"d-flex pt-10"},[e.title?a("project-data",{staticClass:"flex-1",attrs:{icon:"zhanbitu_chart-proportion",title:e.title,specialTitle:""}}):a("project-data",{staticClass:"flex-1",attrs:{icon:"zhanbitu_chart-proportion",title:"项目数",value:e.data.projectNum}}),a("project-data",{staticClass:"flex-1 ml-2",attrs:{icon:"hezi_box",title:"品规数量",value:e.data.productNum}})],1),a("div",{staticClass:"pt-2 d-flex"},[a("project-data",{staticClass:"flex-1",attrs:{icon:"a-bianzu8",title:"目标条目",growNum:e.data.goalNumInc,value:e.data.goalNum,grow:""}}),a("project-data",{staticClass:"flex-1 ml-2",attrs:{icon:"a-bianzu122",title:"准入条目",growNum:e.data.accessNumInc,value:e.data.accessNum,grow:""}})],1),a("div",{staticClass:"mt-2 border-radius-10 background-color-white"},[e._t("default")],2)]),a("van-popup",{attrs:{round:"",position:"bottom"},model:{value:e.showSelectMonth,callback:function(t){e.showSelectMonth=t},expression:"showSelectMonth"}},[a("van-picker",{attrs:{"show-toolbar":"",title:"选择年月",columns:e.columns},on:{confirm:e.onConfirm}})],1),e.showSelect?a("org-dept",{attrs:{show:e.showSelect,resList:e.resList,orgList:e.orgList},on:{search:e.onSearch,confirm:e.onUserConfirm,cancel:e.onCancel}}):e._e()],1)},d=[],h=(a("fb6a"),a("99af"),a("a9e3"),a("5eee")),m=a("5452"),p=a("f270"),f=function(e){Object(i["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(s["a"])(this,a),e=t.apply(this,arguments),e.showSelectMonth=!1,e.showSelect=!1,e}return Object(n["a"])(a,[{key:"onTabChange",value:function(){this.$emit("tabChange")}},{key:"onConfirm",value:function(e){var t=e[1].slice(0,e[1].length-1),a="".concat(e[0].slice(0,4),".").concat(+t>9?t:"0"+t);this.showSelectMonth=!1,this.$emit("monthChange",a)}},{key:"onSearch",value:function(e){this.$emit("search",e)}},{key:"onCancel",value:function(){this.showSelect=!1,this.$emit("search","")}},{key:"onUserConfirm",value:function(e){this.showSelect=!1,this.$emit("userChange",e)}}]),a}(l["d"]);Object(o["a"])([Object(l["c"])({type:Object,default:function(){return{}}})],f.prototype,"data",void 0),Object(o["a"])([Object(l["c"])({type:String,default:""})],f.prototype,"title",void 0),Object(o["a"])([Object(l["c"])({type:String,default:""})],f.prototype,"selectMonth",void 0),Object(o["a"])([Object(l["c"])({type:Number,default:0})],f.prototype,"leaderLevel",void 0),Object(o["a"])([Object(l["c"])({type:Array,default:[]})],f.prototype,"columns",void 0),Object(o["a"])([Object(l["c"])({type:Array,default:[]})],f.prototype,"orgList",void 0),Object(o["a"])([Object(l["c"])({type:Array,default:function(){return[]}})],f.prototype,"resList",void 0),f=Object(o["a"])([Object(l["a"])({components:{BlockTab:h["a"],OrgDept:m["a"],ProjectData:p["a"]}})],f);var g=f,v=g,b=(a("1ad2"),a("2877")),L=Object(b["a"])(v,u,d,!1,null,"72f97c49",null),j=L.exports,O=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:["d-flex align-center py-3 pl-4 textAlignL font-14",e.gray?"background-color-gray-8":"background-color-white"],on:{click:e.onClick}},[a("div",{staticClass:"flex-1 color-main-3"},[e._v(e._s(e.data.projectName))]),a("div",{staticClass:"flex-1 ml-2 slh"},[e._v(e._s(e.data.productNum))]),a("div",{staticClass:"flex-1 ml-2 slh d-flex"},[a("div",[e._v(e._s(e.data.goalNum))]),a("div",{staticClass:"color-normal ml-3"},[e.data.goalNumInc>=0?a("span",[e._v("+")]):e._e(),e._v(e._s(e.data.goalNumInc))])]),a("div",{staticClass:"flex-1 ml-2 slh d-flex"},[a("div",[e._v(e._s(e.data.accessNum))]),a("div",{staticClass:"color-normal ml-3"},[e.data.accessNumInc>=0?a("span",[e._v("+")]):e._e(),e._v(e._s(e.data.accessNumInc))])])])},y=[],k=function(e){Object(i["a"])(a,e);var t=Object(c["a"])(a);function a(){return Object(s["a"])(this,a),t.apply(this,arguments)}return Object(n["a"])(a,[{key:"onClick",value:function(){this.$emit("click")}}]),a}(l["d"]);Object(o["a"])([Object(l["c"])({type:Object,default:{}})],k.prototype,"data",void 0),Object(o["a"])([Object(l["c"])({type:Boolean,default:!1})],k.prototype,"gray",void 0),k=Object(o["a"])([Object(l["a"])({})],k);var C=k,x=C,w=(a("4cbb"),Object(b["a"])(x,O,y,!1,null,"17942e27",null)),S=w.exports,I=a("5acd"),_=a("5669"),P=a("a8ce"),N=function(e){Object(i["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(s["a"])(this,a),e=t.apply(this,arguments),e.columns=[],e.orgOriginList=[],e.orgList=[],e.resList=[],e.selectMonth="",e.placeholder="搜索",e}return Object(n["a"])(a,[{key:"onUserSearch",value:function(e){var t=this;e?(this.orgList=[],this.orgOriginList.forEach((function(a){var r;if(a.name.includes(e))t.orgList.push(a);else if(null!==(r=a.children)&&void 0!==r&&r.length){var s=[];a.children.forEach((function(t){var r;if(t.name.includes(e))s.push(t);else if(null!==(r=t.crmUserDtoList)&&void 0!==r&&r.length){var n=[];t.crmUserDtoList.forEach((function(t){t.userName.includes(e)&&n.push(t)})),n.length&&s.push({id:t.id,name:t.name,parentId:a.id,crmUserDtoList:n})}})),s.length&&t.orgList.push({id:a.id,name:a.name,children:s})}}))):this.orgList=Object(r["a"])(this.orgOriginList)}}]),a}(l["d"]);N=Object(o["a"])([Object(l["a"])({components:{ProjectCommonBlock:j,ThItem:I["a"],ProjectItem:S,ProjectGoodsItem:_["a"],FixButton:P["a"]}})],N);t["a"]=N},"982a":function(e,t,a){},ea32:function(e,t,a){}}]);