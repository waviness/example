(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-579fba0e"],{"08e1":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"user"},[s("user-card",{attrs:{bgIcon:"intl",nowWeather:e.nowWeather,locationCity:e.locationCity,bigBg:""}}),s("div",{staticClass:"userMainWarp"},[s("van-cell-group",e._l(e.userMenu,(function(t,a){return s("van-cell",{key:a,attrs:{title:t.pmsName,"is-link":""},on:{click:function(s){return e.cellClick(t)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("van-icon",{staticClass:"mt-1",staticStyle:{"margin-right":"10px",color:"#363636"},attrs:{name:t.icon}})]},proxy:!0}],null,!0)})})),1)],1),s("van-dialog",{attrs:{showCancelButton:"",title:"意见反馈",theme:"round-button","before-close":e._insertSuggestion},model:{value:e.suggestionShow,callback:function(t){e.suggestionShow=t},expression:"suggestionShow"}},[s("div",{staticClass:"suggestWarp"},[s("van-field",{attrs:{rows:"3",autosize:"",type:"textarea",placeholder:"请输入意见反馈"},model:{value:e.suggestMessage,callback:function(t){e.suggestMessage=t},expression:"suggestMessage"}})],1)]),s("van-popup",{staticClass:"van-popup-bg",style:{height:"90%"},attrs:{round:"",position:"bottom"},model:{value:e.clickInShow,callback:function(t){e.clickInShow=t},expression:"clickInShow"}},[s("div",{staticClass:"clearfix background-color-white"},[s("van-search",{staticClass:"left",staticStyle:{width:"50%"},attrs:{clearable:"",placeholder:"请输入搜索关键词"},on:{input:e.onClickRefresh},model:{value:e.addressSearchValue,callback:function(t){e.addressSearchValue=t},expression:"addressSearchValue"}}),s("van-field",{staticClass:"left",staticStyle:{margin:"10px",padding:"5px",background:"#f7f8fa",width:"40%"},attrs:{readonly:"",clickable:"",name:"datePicker",value:e.dateRange[0]?e.$dayjs(e.dateRange[0]).format("MM-DD")+" ~ "+e.$dayjs(e.dateRange[1]).format("MM-DD")+"("+e.$dayjs(e.dateRange[0]).format("YYYY")+")":"",label:"",placeholder:"点击选择时间"},on:{click:function(t){e.addresstimeShowPicker=!0}}})],1),s("van-calendar",{attrs:{type:"range","default-date":e.dateRange,"min-date":new Date(2020,0,1),"first-day-of-week":"1",color:"#1989fa","show-confirm":!0},on:{confirm:e.calendarConfirm},model:{value:e.addresstimeShowPicker,callback:function(t){e.addresstimeShowPicker=t},expression:"addresstimeShowPicker"}}),s("van-pull-refresh",{staticClass:"pt-10",on:{refresh:e.onClickRefresh},model:{value:e.refreshing,callback:function(t){e.refreshing=t},expression:"refreshing"}},[s("van-list",{staticClass:"px-2",attrs:{offset:20,error:e.error,finished:e.finished,"finished-text":"没有更多了"},on:{"update:error":function(t){e.error=t},load:e.onClickLoad},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},[s("ul",{staticClass:"clickInListWarp"},[e._l(e.dataList,(function(t,a){return s("li",{key:a},[s("div",{staticClass:"clickInListHeader"},[e._v(" 打卡时间： "+e._s(t.credate.substring(0,t.credate.length-3))+" "),s("span",{staticClass:"clickInId right"},[e._v("ID: "+e._s(t.cciId))])]),s("div",{staticClass:"clickInListCommon"},[e._v("打卡地址： "+e._s(t.address))]),s("div",{staticClass:"clickInListCommon"},[e._v(" 打卡经纬度： "+e._s(t.longitude)+"/"+e._s(t.latitude)+" "),s("span",{staticClass:"right"},[e._v(e._s(t.creName))])])])})),s("van-empty",{directives:[{name:"show",rawName:"v-show",value:0===e.clickInList.length&&!e.clickInLoading,expression:"clickInList.length === 0 && !clickInLoading"}],attrs:{description:"暂无打卡记录"}})],2)])],1),e.depTreeList&&e.depTreeList.length?s("div",{staticClass:"commonOpButton-footer"},[s("van-button",{attrs:{round:"",color:"#2271F5",type:"primary",plain:""},on:{click:e.chooseUser}},[e._v(e._s(e.result.length?"已选"+e.result.length+"人":"人员选择")+" ")])],1):e._e()],1),s("van-popup",{style:{height:"70%"},attrs:{round:"",position:"bottom"},model:{value:e.userListShow,callback:function(t){e.userListShow=t},expression:"userListShow"}},[s("van-search",{attrs:{placeholder:"搜索","input-align":"center"},on:{clear:e.onuserSearch,search:e.onuserSearch},model:{value:e.keywords,callback:function(t){e.keywords=t},expression:"keywords"}}),s("van-loading",{directives:[{name:"show",rawName:"v-show",value:e.userDetailListLoading,expression:"userDetailListLoading"}],attrs:{color:"#0094ff"}},[e._v("加载中...")]),s("van-checkbox-group",{staticClass:"overflow-auto",staticStyle:{height:"calc(100% - 140px)"},model:{value:e.result,callback:function(t){e.result=t},expression:"result"}},[s("van-cell-group",e._l(e.userDetailList,(function(t,a){return s("van-cell",{key:t.userId,attrs:{clickable:"",title:t.userId+"/"+t.userName},on:{click:function(t){return e.toggle(a)}},scopedSlots:e._u([{key:"right-icon",fn:function(){return[s("van-checkbox",{ref:"checkboxes",refInFor:!0,attrs:{name:t.userId}})]},proxy:!0}],null,!0)})})),1)],1),s("div",{staticClass:"commonButton-footer d-flex justify-center"},[s("van-button",{attrs:{size:"small",round:"",plain:""},on:{click:e.cancelClick}},[e._v("重置")]),s("van-button",{attrs:{size:"small",color:"#2271F5",type:"info","native-type":"submit",round:""},on:{click:e.handleOk}},[e._v("确定")])],1)],1),s("van-popup",{style:{height:"70%"},attrs:{round:"",position:"bottom"},model:{value:e.queryMessageShow,callback:function(t){e.queryMessageShow=t},expression:"queryMessageShow"}},[s("van-pull-refresh",{on:{refresh:e.onRefresh},model:{value:e.queryMessagerefreshing,callback:function(t){e.queryMessagerefreshing=t},expression:"queryMessagerefreshing"}},[s("van-list",{attrs:{offset:20,"finished-text":"",finished:e.queryMessagefinished},on:{load:e.onLoad},model:{value:e.queryMessageLoading,callback:function(t){e.queryMessageLoading=t},expression:"queryMessageLoading"}},[s("ul",{staticClass:"querySuggestWarp"},e._l(e.queryMessageList,(function(t,a){return s("li",{key:a},[s("p",{staticClass:"clickInListHeader"},[e._v(" 时间： "+e._s(t.credate.substring(0,t.credate.length-3))+" "),s("span",{staticClass:"clickInId right"},[e._v("ID: "+e._s(t.suggestionid))])]),s("p",{staticClass:"clickInListCommon"},[e._v("反馈建议： "+e._s(t.advicemsg))]),s("p",{staticClass:"clickInListCommon"},[e._v("提出人： "+e._s(t.creId)+"/"+e._s(t.creName))])])})),0)])],1),s("van-empty",{directives:[{name:"show",rawName:"v-show",value:0===e.queryMessageList.length&&!e.queryMessageLoading,expression:"queryMessageList.length === 0 && !queryMessageLoading"}],attrs:{description:"暂无反馈信息"}})],1)],1)},i=[],r=s("1da1"),n=s("d4ec"),o=s("bee2"),c=s("262e"),u=s("2caf"),l=(s("96cf"),s("99af"),s("d3b7"),s("159b"),s("9ab4")),d=s("1b40"),h=s("b32d"),g=s("90ae"),f=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",h["a"].post(g["c"],"/api/UserVisit/getCrmClockIn",t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",h["a"].post(g["d"],"/api/suggestion/insertSuggestion",t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",h["a"].post(g["d"],"/api/suggestion/querySuggestion",t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=s("f727"),y=s("53ae"),m=s("8e54"),b=s("2957"),w=s("4bb5"),L=Object(w["a"])("app"),C=Object(w["a"])("crm"),_=function(e){Object(c["a"])(s,e);var t=Object(u["a"])(s);function s(){var e;return Object(n["a"])(this,s),e=t.apply(this,arguments),e.headerImg="",e.userName="",e.userCode="",e.userMenu=[],e.suggestionShow=!1,e.clickInShow=!1,e.suggestMessage="",e.clickInList=[],e.clickInLoading=!1,e.queryMessageShow=!1,e.queryMessageLoading=!1,e.queryMessagefinished=!1,e.queryMessagerefreshing=!1,e.queryMessageList=[],e.messagePage=1,e.addressSearchValue="",e.addresschangeTime="",e.addresstimeShowPicker=!1,e.minDate=new Date(2020,0,1),e.maxDate=new Date(2025,10,1),e.dateRange=[],e.userDetailList=[],e.userDetailListLoading=!1,e.userListShow=!1,e.result=[],e.sureResult=[],e.keywords="",e}return Object(o["a"])(s,[{key:"addressCancel",value:function(){this.addresstimeShowPicker=!1,this.addresschangeTime="",this._getCrmClockIn()}},{key:"onClickRefresh",value:function(){this.finished=!1,this.loading=!1,this.dataList=[],this.page=1,this.onClickLoad()}},{key:"onClickLoad",value:function(){this.refreshing&&(this.page=1,this.dataList=[],this.refreshing=!1),this.loading=!0,this._getCrmClockIn()}},{key:"_getCrmClockIn",value:function(){var e=this;this.clickInList=[],this.clickInLoading=!0;var t={detailFlag:!1,startTime:this.dateRange[0]?this.$dayjs(this.dateRange[0]).format("YYYY-MM-DD"):"--",endTime:this.dateRange[1]?this.$dayjs(this.dateRange[1]).format("YYYY-MM-DD"):"--",keyword:this.addressSearchValue,type:this.depTreeList&&this.depTreeList.length&&this.sureResult.length?2:1,pageNum:this.page,pageSize:20,userList:this.sureResult};f(t).then((function(t){e.loading=!1,e.refreshing=!1,"200"===t.code?(e.dataList=e.dataList.concat(t.data.list),e.page++,e.finished=!t.data.hasNextPage,e.total=t.data.total):e.error=!0})).catch((function(){e.error=!0}))}},{key:"cellClick",value:function(e){switch(e.keyword){case"insertSuggest":this.insertSuggestClick();break;case"querySuggest":this.querySuggestClick();break;case"getClickIn":this.keywords="",this.result=[],this.sureResult=[],this.getClickInMsg();break;default:break}}},{key:"getClickInMsg",value:function(){this.clickInShow=!0,this.dataList=[],this.page=1}},{key:"insertSuggestClick",value:function(){this.suggestionShow=!0}},{key:"querySuggestClick",value:function(){this.queryMessageShow=!0,this.queryMessageLoading=!1,this.queryMessagefinished=!1,this.queryMessagerefreshing=!1,this.queryMessageList=[],this.messagePage=1,this.onRefresh()}},{key:"_insertSuggestion",value:function(e,t){var s=this;if("cancel"!==e){if(!this.suggestMessage)return t(),void this.$nextTick((function(){s.suggestionShow=!0,setTimeout((function(){s.$toast.fail("请输入内容")}))}));var a={advicemsg:this.suggestMessage};p(a).then((function(e){"200"===e.code?(s.suggestionShow=!1,t(),s.$toast.success(e.msg)):s.$toast.fail(e.msg)}))}else t()}},{key:"_querySuggestion",value:function(){var e=this;1===this.messagePage&&(this.queryMessageList=[]),this.queryMessageLoading=!0,v({pageNum:this.messagePage,pageSize:10}).then((function(t){"200"===t.code?(e.queryMessageList=e.queryMessageList.concat(t.data.list),t.data.hasNextPage?e.messagePage++:e.queryMessagefinished=!0):(e.queryMessagerefreshing=!0,e.$toast.fail(t.msg)),e.queryMessageLoading=!1}))}},{key:"onRefresh",value:function(){this.queryMessagerefreshing=!1,this.queryMessageLoading=!0,this.onLoad()}},{key:"onLoad",value:function(){this.queryMessagerefreshing&&(this.messagePage=1,this.queryMessageList=[],this.queryMessagerefreshing=!1),this._querySuggestion()}},{key:"_getDepTree",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{treeType:1,authorizedFlag:!0};return new Promise((function(s){e.actionGetDepTree(t).then((function(e){0===e.data.length&&s(e),s(e)}))}))}},{key:"mapTreeList",value:function(e,t){for(var s=0;s<e.length;s++){var a=e[s];a.operationFlag&&t.push(a.depId),a.childList&&a.childList.length>0&&this.mapTreeList(a.childList,t)}return t}},{key:"_getUserByParams",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.userDetailList=[],this.userDetailListLoading=!0,e.next=4,Object(k["h"])(t);case 4:s=e.sent,this.userDetailList=s.data,this.userDetailListLoading=!1;case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"chooseUser",value:function(){this.userListShow=!0,this.keywords?this.result=this.sureResult:(this.keywords="",this.result=[],this.sureResult=[],this._getUserByParams({keyword:this.keywords,depIdList:this.mapTreeList(this.depTreeList,[]),leaderFlag:!1,authorizedFlag:!0,loading:!0}))}},{key:"toggle",value:function(e){this.$refs.checkboxes[e].toggle()}},{key:"onuserSearch",value:function(){this._getUserByParams({keyword:this.keywords,depIdList:this.mapTreeList(this.depTreeList,[]),leaderFlag:!1,authorizedFlag:!0,loading:!0})}},{key:"cancelClick",value:function(){this.userListShow=!1,this.result=[],this.sureResult=[],this.keywords="",this.onClickRefresh()}},{key:"handleOk",value:function(){this.userListShow=!1,this.sureResult=this.result,this.onClickRefresh()}},{key:"calendarConfirm",value:function(e){this.dateRange=e,this.onClickRefresh(),this.addresstimeShowPicker=!1}},{key:"mounted",value:function(){var e=this,t=this.$dayjs().subtract(15,"day"),s=this.$dayjs();this.dateRange=[new Date(t),new Date(s)];var a=this.userInfor.resListTree;this.userMenu=[],a.forEach((function(t){"我的"===t.pmsName&&t.children.forEach((function(t){3===t.pmsType&&e.userMenu.push(t)}))})),this.wxRegister(),this.depTreeList&&this.depTreeList.length||this._getDepTree()}}]),s}(Object(d["b"])(y["a"],m["a"]));Object(l["a"])([L.Getter],_.prototype,"userInfor",void 0),Object(l["a"])([C.Action],_.prototype,"actionGetDepTree",void 0),Object(l["a"])([C.Getter],_.prototype,"depTreeList",void 0),_=Object(l["a"])([Object(d["a"])({components:{UserCard:b["a"]}})],_);var S=_,M=S,I=(s("de16"),s("2877")),j=Object(I["a"])(M,a,i,!1,null,"b39d4932",null);t["default"]=j.exports},"0b86":function(e,t,s){"use strict";s("a221")},2800:function(e,t,s){},2957:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"user-card"},[a("div",{staticClass:"user-card-left"},[a("img",{staticClass:"user-card-left__img",attrs:{src:e.user.headerImg}}),a("div",{staticClass:"user-card-left__info"},[a("div",[e._v(e._s(e.user.userName))]),a("div",[e._v(e._s(e.user.depName))])])]),a("div",{staticClass:"user-card-right"},[a("div",[a("div",{staticClass:"user-card-right__name"},[e._v(e._s(e.locationCity||"- - - -"))]),a("div",{staticClass:"user-card-right__desc"},[e._v(" "+e._s(e.nowWeather.weather||"--")+"  "+e._s(e.nowWeather.temperature||"？")+"℃ ")])])]),a("img",{class:e.bigBg?"user-card__bigbg":"user-card__bg",attrs:{src:s("c955")("./"+e.bgIcon+".webp")}})])},i=[],r=s("d4ec"),n=s("bee2"),o=s("262e"),c=s("2caf"),u=s("9ab4"),l=s("1b40"),d=s("4bb5"),h=Object(d["a"])("app"),g=function(e){Object(o["a"])(s,e);var t=Object(c["a"])(s);function s(){var e;return Object(r["a"])(this,s),e=t.apply(this,arguments),e.user={},e}return Object(n["a"])(s,[{key:"toUsercenter",value:function(){this.$router.push({name:"Usercenter"})}},{key:"mounted",value:function(){var e=this.$root,t=this.userInfor,s=t.userId,a=t.userName,i=t.depName,r=t.headImgUrl;this.user={userId:s,userName:a,depName:i,headerImg:e.domainUrl+r}}}]),s}(l["d"]);Object(u["a"])([h.Getter],g.prototype,"userInfor",void 0),Object(u["a"])([Object(l["c"])({type:String,default:""})],g.prototype,"bgIcon",void 0),Object(u["a"])([Object(l["c"])({type:String,default:""})],g.prototype,"locationCity",void 0),Object(u["a"])([Object(l["c"])({default:{}})],g.prototype,"nowWeather",void 0),Object(u["a"])([Object(l["c"])({type:Boolean,default:!1})],g.prototype,"bigBg",void 0),g=Object(u["a"])([Object(l["a"])({})],g);var f=g,p=f,v=(s("0b86"),s("2877")),k=Object(v["a"])(p,a,i,!1,null,"5ee1bd70",null);t["a"]=k.exports},"53ae":function(e,t,s){"use strict";var a=s("d4ec"),i=s("bee2"),r=s("262e"),n=s("2caf"),o=(s("b0c0"),s("9ab4")),c=s("1b40");c["a"].registerHooks(["beforeRouteEnter"]);var u=function(e){Object(r["a"])(s,e);var t=Object(n["a"])(s);function s(){var e;return Object(a["a"])(this,s),e=t.apply(this,arguments),e.page=1,e.total=0,e.dataList=[],e.loading=!1,e.finished=!1,e.refreshing=!1,e.finishText="",e.userIdList=[],e.error=!1,e}return Object(i["a"])(s,[{key:"beforeRouteEnter",value:function(e,t,s){s((function(e){"Home"!==t.name&&"TaskIndex"!==t.name||(e.dataList=[],e.page=1,e.loading=!1,e.finished=!0,e.refreshing=!1,e.$nextTick((function(){e.finished=!1})))}))}}]),s}(c["d"]);u=Object(o["a"])([Object(c["a"])({})],u),t["a"]=u},a221:function(e,t,s){},de16:function(e,t,s){"use strict";s("2800")}}]);