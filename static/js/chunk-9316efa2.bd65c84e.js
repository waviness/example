(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9316efa2"],{"12db":function(e,t,s){"use strict";s("7d84")},"53ae":function(e,t,s){"use strict";var a=s("d4ec"),n=s("bee2"),r=s("262e"),i=s("2caf"),c=(s("b0c0"),s("9ab4")),o=s("1b40");o["a"].registerHooks(["beforeRouteEnter"]);var l=function(e){Object(r["a"])(s,e);var t=Object(i["a"])(s);function s(){var e;return Object(a["a"])(this,s),e=t.apply(this,arguments),e.page=1,e.total=0,e.dataList=[],e.loading=!1,e.finished=!1,e.refreshing=!1,e.finishText="",e.userIdList=[],e.error=!1,e}return Object(n["a"])(s,[{key:"beforeRouteEnter",value:function(e,t,s){s((function(e){"Home"!==t.name&&"TaskIndex"!==t.name||(e.dataList=[],e.page=1,e.loading=!1,e.finished=!0,e.refreshing=!1,e.$nextTick((function(){e.finished=!1})))}))}}]),s}(o["d"]);l=Object(c["a"])([Object(o["a"])({})],l),t["a"]=l},"7d84":function(e,t,s){},b872:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"full-HW van-popup-bg task-supervise pt-3"},[s("div",{staticClass:"py-3 px-5 background-color-white"},[s("div",{staticClass:"font-15 lineHeight-21 fontWeight-500"},[e._v("任务督办")]),e.sendPersons.length>0?s("div",{staticClass:"mt-1 lineHeight-18 color-gray-4 font-12"},[e._v(" 您正在发起对 "),s("span",{staticClass:"color-main-2"},e._l(e.sendPersons,(function(t,a){return s("span",{key:a},[e._v(" "+e._s(t.sendUserName)+" "),a<e.sendPersons.length-1?s("span",[e._v("、")]):e._e()])})),0),e._v(" 的任务督办 ")]):e._e(),0==e.sendPersons.length?s("div",{staticClass:"mt-1 lineHeight-18 color-gray-4 font-12"},[e._v("暂未选择督办人")]):e._e()]),s("div",{staticClass:"d-flex align-center justify-space-between mt-2 background-color-white py-3 px-4 font-14"},[s("span",{staticClass:"color-gray-5 lineHeight-20"},[e._v("事件等级")]),s("van-radio-group",{attrs:{direction:"horizontal"},model:{value:e.params.level,callback:function(t){e.$set(e.params,"level",t)},expression:"params.level"}},[s("van-radio",{staticClass:"mr-6",attrs:{name:"1"}},[e._v("普通")]),s("van-radio",{staticClass:"mr-6",attrs:{name:"2"}},[e._v("重要")]),s("van-radio",{staticClass:"mr-0",attrs:{name:"3"}},[e._v("紧急")])],1)],1),s("div",{staticClass:"d-flex align-center justify-space-between mt-2 background-color-white py-3 px-4 font-14",on:{click:function(t){return t.stopPropagation(),e.getUsersClick.apply(null,arguments)}}},[s("span",{staticClass:"color-gray-5 lineHeight-20"},[e._v("匹配督办人")]),s("span",{staticClass:"color-main-2"},e._l(e.sendPersons,(function(t,a){return s("span",{key:a},[e._v(" "+e._s(t.sendUserName)+" "),a<e.sendPersons.length-1?s("span",[e._v("、")]):e._e()])})),0)]),s("div",{staticClass:"py-3 px-5 mt-2 background-color-white font-14"},[s("div",{staticClass:"color-gray-5 lineHeight-20"},[e._v("补充意见")]),s("van-field",{staticClass:"pa-0 font-14 mt-1",attrs:{rows:"2",autosize:"",type:"textarea",placeholder:"请输入意见"},model:{value:e.params.message,callback:function(t){e.$set(e.params,"message",t)},expression:"params.message"}})],1),s("div",{staticClass:"py-3 px-4 mt-2 background-color-white"},[s("div",{staticClass:"color-gray-5 lineHeight-20 mb-3 font-14"},[e._v("附件")]),s("img",{staticClass:"task-img",attrs:{src:e.params.url},on:{click:e.showImage}})]),s("div",{staticClass:"button-div"},[s("van-button",{staticClass:"mr-3",attrs:{round:""},on:{click:e.cancel}},[e._v("取消")]),s("van-button",{attrs:{round:"",type:"info"},on:{click:e._addSynergiaOrder}},[e._v("发送")])],1),e.hasDept?s("dept-user",{ref:"deptUer",attrs:{show:e.changeTypeShow,loading:e.getUserListLoading,depTreeList:e.depTreeList,deptUserData:e.deptUserData,searchList:e.userDataList},on:{search:e.refreshUserByKeywords,refresh:e.refreshUserByDepts,confirm:e.onTreeConfirm,cancel:e.cancelUserByDepts}}):e._e()],1)},n=[],r=(s("4662"),s("28a2")),i=s("d4ec"),c=s("bee2"),o=s("262e"),l=s("2caf"),d=(s("4de4"),s("d3b7"),s("caad"),s("2532"),s("ac1f"),s("1276"),s("466d"),s("81b2"),s("0eb6"),s("b7ef"),s("8bd4"),s("5cc6"),s("907a"),s("9a8c"),s("a975"),s("735e"),s("c1ac"),s("d139"),s("3a7b"),s("d5d6"),s("82f8"),s("e91f"),s("60bd"),s("5f96"),s("3280"),s("3fcc"),s("ca91"),s("25a1"),s("cd26"),s("3c5d"),s("2954"),s("649e"),s("219c"),s("170b"),s("b39a"),s("72f7"),s("99af"),s("5319"),s("9ab4")),p=s("1b40"),u=s("8393"),h=s("53ae"),f=s("8b7c"),g=function(e){Object(o["a"])(s,e);var t=Object(l["a"])(s);function s(){var e;return Object(i["a"])(this,s),e=t.apply(this,arguments),e.params={level:"3",message:"",url:null},e.sendPersons=[],e}return Object(c["a"])(s,[{key:"showImage",value:function(){Object(r["a"])([this.params.url])}},{key:"getUsersClick",value:function(){if(this.depTreeList&&0!==this.depTreeList.length){this.changeTypeShow=!0;var e=this.$refs.deptUer;e.userDataList.length||this._getUserByParams({depIdList:this.mapTreeList(this.depTreeList,[]),leaderFlag:this.leaderFlag,authorizedFlag:this.authorizedFlag},this.depTreeList[0].depId)}else this.$toast.fail("当前登录人员未维护人员上下级关系，请联系管理员处理。")}},{key:"onTreeConfirm",value:function(e){var t=this;this.checkedUsers=e;var s=this.userDataList.filter((function(t){return e.includes(t.userId)}));this.checkDetailList=s;var a=[];this.sendPersons=[];for(var n=function(s){var n=t.checkDetailList[s];-1===e.indexOf(n.userId)||a.some((function(e){return n.userId===e.userId}))||a.push(n)},r=0;r<this.checkDetailList.length;r++)n(r);for(var i=0;i<this.checkDetailList.length;i++){var c=this.checkDetailList[i];this.sendPersons.push({distributeId:c.userMainDepNum,distribute:c.userMainDepName,orderType:1,sendUserId:c.userId,sendUserName:c.userName})}this.checkDetailList=a,this.changeTypeShow=!1}},{key:"base64toFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"file",s=e.split(","),a=s[0].match(/:(.*?);/)[1],n=a.split("/")[1],r=atob(s[1]),i=r.length,c=new Uint8Array(i);while(i--)c[i]=r.charCodeAt(i);return new File([c],"".concat(t,".").concat(n),{type:a})}},{key:"_addSynergiaOrder",value:function(){var e=this;if(this.params.level)if(this.sendPersons.length){for(var t=this.$toast.loading("生成任务督办中..."),s=new FormData,a=this.base64toFile(this.params.url),n=0;n<this.sendPersons.length;n++){var r=this.sendPersons[n];s.append("sendPersons[".concat(n,"].sendUserId"),r.sendUserId),s.append("sendPersons[".concat(n,"].distribute"),r.distribute),s.append("sendPersons[".concat(n,"].distributeId"),r.distributeId),s.append("sendPersons[".concat(n,"].orderType"),r.orderType)}s.append("imageFileList",a),s.append("emergencyLevel",this.params.level),s.append("eventAgeingStart",""),s.append("eventAgeingEnd",""),s.append("isReturn","1"),s.append("orderContent",this.params.message),s.append("orderTitle","cdp任务督办"),s.append("smallTagId","0"),s.append("synergiaType","1"),Object(f["a"])(s).then((function(s){"200"===s.code?e.$toast.success(s.msg):e.$toast.fail(s.msg),t.clear(),e.$router.go(-1)}))}else this.$toast.fail("请选择督办人");else this.$toast.fail("请选择事件等级")}},{key:"cancel",value:function(){this.$router.go(-1)}},{key:"mounted",value:function(){var e=this;this.$route.params&&this.$nextTick((function(){e.params.url=e.$route.params.url.replace(/[\r\n]/g,"")}))}}]),s}(Object(p["b"])(u["a"],h["a"]));g=Object(d["a"])([Object(p["a"])({beforeRouteEnter:function(e,t,s){s((function(e){e.$crmUserClick({catalogType:1,catalogTypeName:"CDP",cucrId:"",menuId:"",menuName:"",menuOperation:"任务督办",operationType:3})}))}})],g);var v=g,m=v,b=(s("12db"),s("2877")),y=Object(b["a"])(m,a,n,!1,null,"3df0a3c2",null);t["default"]=y.exports}}]);